{"version":3,"sources":["webpack:///background.js","webpack:///webpack/bootstrap c8824652d8aadf6a2069?c586","webpack:///./src/requests.js","webpack:///./src/background.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","2","post","url","payload","body","params","getParamString","fetch","method","headers","Accept","Content-Type","JSON","stringify","then","res","text","postMicropub","form","token","Authorization","FormData","prop","push","join","6","_interopRequireDefault","obj","default","handleMessage","request","sender","sendResponse","console","log","action","handleBeginAuth","localStorage","setItem","domain","metadata","authEndpoint","tokenEndpoint","micropub","chrome","tabs","create","authUrl","tab","authTabId","tabId","handleTabChange","changeInfo","isAuthRedirect","code","getParamFromUrl","fetchToken","data","getParamFromUrlString","remove","id","status","startsWith","paramName","split","matches","filter","param","length","substr","decodeURIComponent","redirect_uri","client_id","me","getItem","_requests2","_requests","runtime","onMessage","addListener","onUpdated"],"mappings":"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","file":"background.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 6);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 2:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction post(url, payload, body) {\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(url + '?' + params, {\n    method: 'POST',\n    headers: {\n      'Accept': 'application/json, text/plain, */*',\n      'Content-Type': 'application/json'\n    },\n    body: body ? JSON.stringify(body) : null\n  }).then(function (res) {\n    return res.text();\n  });\n}\n\nfunction postMicropub(url, form, token) {\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Authorization': 'Bearer ' + token\n    },\n    body: new FormData(form)\n  }).then(function (res) {\n    return res.text();\n  });\n}\n\nfunction getParamString(payload) {\n  var params = [];\n  for (var prop in payload) {\n    params.push(prop + '=' + payload[prop]);\n  }\n  return params.join('&');\n}\n\nmodule.exports = {\n  post: post,\n  postMicropub: postMicropub,\n  getParamString: getParamString\n};\n\n/***/ }),\n\n/***/ 6:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _requests = __webpack_require__(2);\n\nvar _requests2 = _interopRequireDefault(_requests);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar authTabId = null;\n\nfunction handleMessage(request, sender, sendResponse) {\n  console.log('handling message', request);\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  console.log(payload);\n  localStorage.setItem('domain', payload.domain);\n  localStorage.setItem('authEndpoint', payload.metadata.authEndpoint);\n  localStorage.setItem('tokenEndpoint', payload.metadata.tokenEndpoint);\n  localStorage.setItem('micropubEndpoint', payload.metadata.micropub);\n  chrome.tabs.create({ url: payload.authUrl }, function (tab) {\n    console.log('tab created');\n    authTabId = payload.tabId;\n  });\n}\n\nfunction handleTabChange(tabId, changeInfo, tab) {\n  console.log(tabId, authTabId);\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  console.log('match');\n  debugger;\n  var code = getParamFromUrl('code', changeInfo.url);\n  fetchToken(code).then(function (data) {\n    var token = getParamFromUrlString('access_token', data);\n    localStorage.setItem('token', token);\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  });\n}\n\nfunction isAuthRedirect(changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  console.log('changeInfo', changeInfo);\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\n// TODO move to util\nfunction getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\n// TODO move to util\nfunction getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(function (param) {\n    return param.startsWith(paramName + '=');\n  });\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: 'http://keithjgrant.com'\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return _requests2.default.post(tokenEndpoint, params);\n}\n\n(function () {\n  chrome.runtime.onMessage.addListener(handleMessage);\n  chrome.tabs.onUpdated.addListener(handleTabChange);\n})();\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// background.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c8824652d8aadf6a2069","\nfunction post (url, payload, body) {\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(`${url}?${params}`, {\n    method: 'POST',\n    headers: {\n       'Accept': 'application/json, text/plain, */*',\n       'Content-Type': 'application/json'\n   },\n    body: body ? JSON.stringify(body) : null\n  })\n  .then(function (res) {\n    return res.text();\n  });\n}\n\nfunction postMicropub (url, form, token) {\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n    },\n    body: new FormData(form)\n  })\n  .then(function (res) {\n    return res.text();\n  });\n}\n\nfunction getParamString (payload) {\n  var params = [];\n  for (var prop in payload) {\n    params.push(`${prop}=${payload[prop]}`);\n  }\n  return params.join('&');\n}\n\nmodule.exports = {\n  post: post,\n  postMicropub: postMicropub,\n  getParamString: getParamString\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/requests.js","import requests from './requests';\n\nvar authTabId = null;\n\nfunction handleMessage(request, sender, sendResponse) {\n  console.log('handling message', request);\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  console.log(payload);\n  localStorage.setItem('domain', payload.domain);\n  localStorage.setItem('authEndpoint', payload.metadata.authEndpoint);\n  localStorage.setItem('tokenEndpoint', payload.metadata.tokenEndpoint);\n  localStorage.setItem('micropubEndpoint', payload.metadata.micropub);\n  chrome.tabs.create({url: payload.authUrl}, (tab) => {\n    console.log('tab created');\n    authTabId = payload.tabId;\n  });\n}\n\nfunction handleTabChange (tabId, changeInfo, tab) {\n  console.log(tabId, authTabId);\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  console.log('match');\n  debugger;\n  var code = getParamFromUrl('code', changeInfo.url);\n  fetchToken(code)\n  .then(function (data) {\n    var token = getParamFromUrlString('access_token', data);\n    localStorage.setItem('token', token)\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  });\n}\n\nfunction isAuthRedirect (changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  console.log('changeInfo', changeInfo);\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\n// TODO move to util\nfunction getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\n// TODO move to util\nfunction getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(param => param.startsWith(`${paramName}=`));\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: 'http://keithjgrant.com'\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return requests.post(tokenEndpoint, params);\n}\n\n(function () {\n  chrome.runtime.onMessage.addListener(handleMessage);\n  chrome.tabs.onUpdated.addListener(handleTabChange);\n}());\n\n\n\n// WEBPACK FOOTER //\n// ./src/background.js"],"sourceRoot":""}