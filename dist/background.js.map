{"version":3,"sources":["webpack:///background.js","webpack:///webpack/bootstrap 7cdb821dcd93ececc2a6","webpack:///./src/util/utils.js","webpack:///./~/parse-uri/index.js","webpack:///./src/background.js","webpack:///./src/util/requests.js","webpack:///./src/util/url.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","1","openLink","e","preventDefault","target","href","chrome","tabs","create","url","clone","obj","JSON","parse","stringify","getAuthTab","Promise","resolve","reject","query","length","logout","items","map","item","localStorage","removeItem","18","str","opts","key","q","parser","strict","loose","strictMode","exec","uri","replace","$0","$1","$2","19","handleMessage","request","sender","sendResponse","action","handleBeginAuth","payload","updateFocusedWindow","selectedEntry","selectEntry","clearEntry","setItem","domain","metadata","authEndpoint","tokenEndpoint","micropub","authUrl","tab","authTabId","id","_url","cleanUrl","handleTabChange","tabId","changeInfo","isAuthRedirect","code","getParamFromUrl","fetchToken","then","data","token","access_token","Error","remove","catch","err","_utils","sendMessage","error","message","status","startsWith","params","redirect_uri","client_id","me","getItem","_requests","post","response","formEncodedToObject","error_description","menuId","runtime","onMessage","addListener","onUpdated","contextMenus","title","contexts","onclick","window","open","3","getParamString","fetch","method","res","text","prop","Array","isArray","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","val","push","return","join","formString","parts","split","forEach","param","_param$split","_param$split2","_slicedToArray","decodeURIParam","endsWith","k","substr","decodeURIComponent","postFormData","headers","Authorization","body","formDataFromObject","FormData","fieldName","append","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","TypeError","7","_interopRequireDefault","default","paramName","getParamFromUrlString","matches","filter","cleanParams","clean","paramsToQueryString","_parseUri2","base","protocol","host","port","path","queryKey","_parseUri"],"mappings":"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","file":"background.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 19);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 1:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.openLink = openLink;\nexports.clone = clone;\nexports.getAuthTab = getAuthTab;\nexports.logout = logout;\nfunction openLink(e) {\n  e.preventDefault();\n  if (e.target.href) {\n    chrome.tabs.create({ url: e.target.href });\n  }\n}\n\nfunction clone(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nfunction getAuthTab() {\n  return new Promise(function (resolve, reject) {\n    chrome.tabs.query({ url: 'http://omnibear.com/auth/success*' }, function (tabs) {\n      if (tabs.length) {\n        resolve(tabs[0]);\n      } else {\n        reject('Auth tab not found');\n      }\n    });\n  });\n}\n\nfunction logout() {\n  var items = ['token', 'domain', 'authEndpoint', 'tokenEndpoint', 'micropubEndpoint'];\n  items.map(function (item) {\n    return localStorage.removeItem(item);\n  });\n}\n\n/***/ }),\n\n/***/ 18:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function parseURI (str, opts) {\n  opts = opts || {}\n\n  var o = {\n    key: ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'],\n    q: {\n      name: 'queryKey',\n      parser: /(?:^|&)([^&=]*)=?([^&]*)/g\n    },\n    parser: {\n      strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n    }\n  }\n\n  var m = o.parser[opts.strictMode ? 'strict' : 'loose'].exec(str)\n  var uri = {}\n  var i = 14\n\n  while (i--) uri[o.key[i]] = m[i] || ''\n\n  uri[o.q.name] = {}\n  uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {\n    if ($1) uri[o.q.name][$1] = $2\n  })\n\n  return uri\n}\n\n\n/***/ }),\n\n/***/ 19:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _requests = __webpack_require__(3);\n\nvar _url = __webpack_require__(7);\n\nvar _utils = __webpack_require__(1);\n\nvar authTabId = null;\nvar menuId = void 0;\n\nfunction handleMessage(request, sender, sendResponse) {\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n    case 'focus-window':\n      updateFocusedWindow(sender.url, request.payload.selectedEntry);\n      break;\n    case 'select-entry':\n      selectEntry(request.payload.url);\n      break;\n    case 'clear-entry':\n      clearEntry();\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  localStorage.setItem('domain', payload.domain);\n  localStorage.setItem('authEndpoint', payload.metadata.authEndpoint);\n  localStorage.setItem('tokenEndpoint', payload.metadata.tokenEndpoint);\n  localStorage.setItem('micropubEndpoint', payload.metadata.micropub);\n  chrome.tabs.create({ url: payload.authUrl }, function (tab) {\n    authTabId = tab.id;\n  });\n}\n\nfunction updateFocusedWindow(url, selectedEntry) {\n  localStorage.setItem('pageUrl', (0, _url.cleanUrl)(url));\n  if (selectedEntry) {\n    selectEntry(selectedEntry);\n  } else {\n    clearEntry();\n  }\n}\n\nfunction selectEntry(url) {\n  localStorage.setItem('selectedEntry', url);\n}\n\nfunction clearEntry() {\n  localStorage.removeItem('selectedEntry');\n}\n\nfunction handleTabChange(tabId, changeInfo, tab) {\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  var code = (0, _url.getParamFromUrl)('code', changeInfo.url);\n  fetchToken(code).then(function (data) {\n    var token = data.access_token;\n    if (!token) {\n      throw new Error('Token not found in token endpoint response. Missing expected field \\'access_token\\'');\n    }\n    localStorage.setItem('token', token);\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  }).catch(function (err) {\n    (0, _utils.getAuthTab)().then(function (tab) {\n      chrome.tabs.sendMessage(tab.id, {\n        action: 'fetch-token-error',\n        payload: {\n          error: err.message\n        }\n      });\n      (0, _utils.logout)();\n    });\n  });\n}\n\nfunction isAuthRedirect(changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: localStorage.getItem('domain')\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return (0, _requests.post)(tokenEndpoint, params).then(function (response) {\n    var data = (0, _requests.formEncodedToObject)(response);\n    if (data.error) {\n      throw new Error(data.error_description || data.error);\n    }\n    return data;\n  });\n}\n\nchrome.runtime.onMessage.addListener(handleMessage);\nchrome.tabs.onUpdated.addListener(handleTabChange);\nmenuId = chrome.contextMenus.create({\n  title: 'Reply to entry',\n  contexts: ['page', 'selection'],\n  onclick: function onclick() {\n    window.open(\"index.html?reply=true\", \"extension_popup\", \"width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000\");\n  }\n});\n\n// chrome.contextMenus.create({\n//   title: 'Reply to link url',\n//   contexts: ['link'],\n//   onclick: function (context) {\n//     chrome.runtime.sendMessage({ action: 'remove-entry-highlight' });\n//     selectEntry(context.linkUrl);\n//     window.open(\"index.html\", \"extension_popup\", \"width=450,height=500,status=no,scrollbars=yes,resizable=no\");\n//   },\n// });\n\n/***/ }),\n\n/***/ 3:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nexports.post = post;\nexports.getParamString = getParamString;\nexports.formEncodedToObject = formEncodedToObject;\nexports.postFormData = postFormData;\nexports.formDataFromObject = formDataFromObject;\n\n// TODO: refactor\nfunction post(url, payload) {\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(url + '?' + params, {\n    method: 'POST'\n  }).then(function (res) {\n    return res.text();\n  });\n}\n\nfunction getParamString(payload) {\n  var params = [];\n  for (var prop in payload) {\n    var value = payload[prop];\n    if (Array.isArray(value)) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = value[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var val = _step.value;\n\n          params.push(prop + '[]=' + val);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    } else {\n      params.push(prop + '=' + value);\n    }\n  }\n  return params.join('&');\n}\n\nfunction formEncodedToObject(formString) {\n  var data = {};\n  var parts = formString.split('&');\n  parts.forEach(function (param, i) {\n    var _param$split = param.split('='),\n        _param$split2 = _slicedToArray(_param$split, 2),\n        key = _param$split2[0],\n        val = _param$split2[1];\n\n    var value = decodeURIParam(val);\n    if (key.endsWith('[]')) {\n      var k = key.substr(0, key.length - 2);\n      data[k] = data[k] || [];\n      data[k].push(value);\n    } else {\n      data[key] = value;\n    }\n  });\n  return data;\n}\n\nfunction decodeURIParam(param) {\n  var str = param.replace(/\\+/g, ' ');\n  return decodeURIComponent(str);\n}\n\n// x-www-form-urlencoded example: https://hacks.mozilla.org/2015/03/this-api-is-so-fetching/\n\nfunction postFormData(url, payload, token) {\n  return new Promise(function (resolve, reject) {\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Authorization': 'Bearer ' + token\n      },\n      body: formDataFromObject(payload)\n    }).then(function (res) {\n      if (res.status < 200 || res.status >= 400) {\n        return reject(res.status);\n      }\n      // TODO: get location/url of post & display somehow\n      // res.headers.get('Location') -> null -- CORS blocking?\n      resolve(res.text());\n    });\n  });\n}\n\nfunction formDataFromObject(obj) {\n  var data = new FormData();\n  for (var fieldName in obj) {\n    if (Array.isArray(obj[fieldName])) {\n      obj[fieldName].forEach(function (val, k) {\n        data.append(fieldName, val);\n      });\n    } else {\n      data.append(fieldName, obj[fieldName]);\n    }\n  }\n  return data;\n}\n\n/***/ }),\n\n/***/ 7:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getParamFromUrl = getParamFromUrl;\nexports.getParamFromUrlString = getParamFromUrlString;\nexports.cleanParams = cleanParams;\nexports.paramsToQueryString = paramsToQueryString;\nexports.cleanUrl = cleanUrl;\n\nvar _parseUri = __webpack_require__(18);\n\nvar _parseUri2 = _interopRequireDefault(_parseUri);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\nfunction getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(function (param) {\n    return param.startsWith(paramName + '=');\n  });\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nfunction cleanParams(params) {\n  var clean = {};\n  for (var i in params) {\n    if (!i.startsWith('utm_')) {\n      clean[i] = params[i];\n    }\n  }\n  return clean;\n}\n\nfunction paramsToQueryString(params) {\n  var parts = [];\n  for (var i in params) {\n    parts.push(i + '=' + params[i]);\n  }\n  if (!parts.length) {\n    return '';\n  }\n  return '?' + parts.join('&');\n}\n\n// strip hashes and utm_* query params\nfunction cleanUrl(url) {\n  var parts = (0, _parseUri2.default)(url);\n  var base = [parts.protocol, '://', parts.host, parts.port ? ':' + parts.port : '', parts.path, paramsToQueryString(cleanParams(parts.queryKey))].join('');\n  return base;\n}\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// background.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7cdb821dcd93ececc2a6","\nexport function openLink(e) {\n  e.preventDefault();\n  if (e.target.href) {\n    chrome.tabs.create({ url: e.target.href });\n  }\n}\n\nexport function clone(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nexport function getAuthTab() {\n  return new Promise(function(resolve, reject) {\n    chrome.tabs.query({url: 'http://omnibear.com/auth/success*'}, function(tabs) {\n      if (tabs.length) {\n        resolve(tabs[0]);\n      } else {\n        reject('Auth tab not found');\n      }\n  });\n});\n}\n\nexport function logout() {\n  const items = ['token', 'domain', 'authEndpoint', 'tokenEndpoint', 'micropubEndpoint'];\n  items.map((item) => localStorage.removeItem(item));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util/utils.js","'use strict'\n\nmodule.exports = function parseURI (str, opts) {\n  opts = opts || {}\n\n  var o = {\n    key: ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'],\n    q: {\n      name: 'queryKey',\n      parser: /(?:^|&)([^&=]*)=?([^&]*)/g\n    },\n    parser: {\n      strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n    }\n  }\n\n  var m = o.parser[opts.strictMode ? 'strict' : 'loose'].exec(str)\n  var uri = {}\n  var i = 14\n\n  while (i--) uri[o.key[i]] = m[i] || ''\n\n  uri[o.q.name] = {}\n  uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {\n    if ($1) uri[o.q.name][$1] = $2\n  })\n\n  return uri\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/parse-uri/index.js\n// module id = 18\n// module chunks = 1","import {post, formEncodedToObject} from './util/requests';\nimport {getParamFromUrl, getParamFromUrlString, cleanUrl} from './util/url';\nimport {getAuthTab, logout} from './util/utils';\n\nlet authTabId = null;\nlet menuId;\n\nfunction handleMessage(request, sender, sendResponse) {\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n    case 'focus-window':\n      updateFocusedWindow(sender.url, request.payload.selectedEntry);\n      break;\n    case 'select-entry':\n      selectEntry(request.payload.url);\n      break;\n    case 'clear-entry':\n      clearEntry();\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  localStorage.setItem('domain', payload.domain);\n  localStorage.setItem('authEndpoint', payload.metadata.authEndpoint);\n  localStorage.setItem('tokenEndpoint', payload.metadata.tokenEndpoint);\n  localStorage.setItem('micropubEndpoint', payload.metadata.micropub);\n  chrome.tabs.create({url: payload.authUrl}, (tab) => {\n    authTabId = tab.id;\n  });\n}\n\nfunction updateFocusedWindow(url, selectedEntry) {\n  localStorage.setItem('pageUrl', cleanUrl(url));\n  if (selectedEntry) {\n    selectEntry(selectedEntry);\n  } else {\n    clearEntry();\n  }\n}\n\nfunction selectEntry(url) {\n  localStorage.setItem('selectedEntry', url);\n}\n\nfunction clearEntry() {\n  localStorage.removeItem('selectedEntry');\n}\n\nfunction handleTabChange (tabId, changeInfo, tab) {\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  var code = getParamFromUrl('code', changeInfo.url);\n  fetchToken(code)\n  .then(function (data) {\n    const token = data.access_token;\n    if (!token) {\n      throw new Error('Token not found in token endpoint response. Missing expected field \\'access_token\\'');\n    }\n    localStorage.setItem('token', token);\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  })\n  .catch(function (err) {\n    getAuthTab()\n    .then((tab) => {\n      chrome.tabs.sendMessage(tab.id, {\n        action: 'fetch-token-error',\n        payload: {\n          error: err.message,\n        },\n      });\n      logout();\n    });\n  });\n}\n\nfunction isAuthRedirect (changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: localStorage.getItem('domain'),\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return post(tokenEndpoint, params)\n  .then(function (response) {\n    const data = formEncodedToObject(response);\n    if (data.error) {\n      throw new Error(data.error_description || data.error);\n    }\n    return data;\n  });\n}\n\nchrome.runtime.onMessage.addListener(handleMessage);\nchrome.tabs.onUpdated.addListener(handleTabChange);\nmenuId = chrome.contextMenus.create({\n  title: 'Reply to entry',\n  contexts: ['page', 'selection'],\n  onclick: function () {\n    window.open(\"index.html?reply=true\", \"extension_popup\", \"width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000\");\n  },\n});\n\n// chrome.contextMenus.create({\n//   title: 'Reply to link url',\n//   contexts: ['link'],\n//   onclick: function (context) {\n//     chrome.runtime.sendMessage({ action: 'remove-entry-highlight' });\n//     selectEntry(context.linkUrl);\n//     window.open(\"index.html\", \"extension_popup\", \"width=450,height=500,status=no,scrollbars=yes,resizable=no\");\n//   },\n// });\n\n\n\n// WEBPACK FOOTER //\n// ./src/background.js","\n// TODO: refactor\nexport function post (url, payload) {\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(`${url}?${params}`, {\n    method: 'POST',\n  })\n  .then(function (res) {\n    return res.text();\n  });\n}\n\nexport function getParamString (payload) {\n  var params = [];\n  for (var prop in payload) {\n    const value = payload[prop];\n    if (Array.isArray(value)) {\n      for (let val of value) {\n        params.push(`${prop}[]=${val}`);\n      }\n    } else {\n      params.push(`${prop}=${value}`);\n    }\n  }\n  return params.join('&');\n}\n\nexport function formEncodedToObject(formString) {\n  const data = {};\n  const parts = formString.split('&');\n  parts.forEach((param, i) => {\n    const [key, val] = param.split('=');\n    const value = decodeURIParam(val);\n    if (key.endsWith('[]')) {\n      const k = key.substr(0, key.length-2);\n      data[k] = data[k] || [];\n      data[k].push(value);\n    } else {\n      data[key] = value;\n    }\n  });\n  return data;\n}\n\nfunction decodeURIParam(param) {\n  const str = param.replace(/\\+/g, ' ');\n  return decodeURIComponent(str);\n}\n\n// x-www-form-urlencoded example: https://hacks.mozilla.org/2015/03/this-api-is-so-fetching/\n\nexport function postFormData(url, payload, token) {\n  return new Promise(function (resolve, reject) {\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n      body: formDataFromObject(payload),\n    })\n    .then(function (res) {\n      if (res.status < 200 || res.status >= 400) {\n        return reject(res.status);\n      }\n      // TODO: get location/url of post & display somehow\n      // res.headers.get('Location') -> null -- CORS blocking?\n      resolve(res.text());\n    });\n  });\n}\n\nexport function formDataFromObject(obj) {\n  var data = new FormData();\n  for (var fieldName in obj) {\n    if (Array.isArray(obj[fieldName])) {\n      obj[fieldName].forEach((val, k) => {\n        data.append(fieldName, val);\n      });\n    } else {\n      data.append(fieldName, obj[fieldName]);\n    }\n  }\n  return data;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util/requests.js","import parseUri from 'parse-uri';\n\nexport function getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\nexport function getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(param => param.startsWith(`${paramName}=`));\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nexport function cleanParams(params) {\n  const clean = {};\n  for (let i in params) {\n    if (!i.startsWith('utm_')) {\n      clean[i] = params[i];\n    }\n  }\n  return clean;\n}\n\nexport function paramsToQueryString(params) {\n  const parts = [];\n  for (let i in params) {\n    parts.push(`${i}=${params[i]}`);\n  }\n  if (!parts.length) {\n    return '';\n  }\n  return `?${parts.join('&')}`;\n}\n\n// strip hashes and utm_* query params\nexport function cleanUrl(url) {\n  const parts = parseUri(url);\n  const base = [\n    parts.protocol,\n    '://',\n    parts.host,\n    parts.port ? `:${parts.port}` : '',\n    parts.path,\n    paramsToQueryString(cleanParams(parts.queryKey))\n  ].join('');\n  return base;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util/url.js"],"sourceRoot":""}