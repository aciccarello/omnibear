{"version":3,"sources":["webpack:///background.js","webpack:///webpack/bootstrap 6d1ed100ed120854df2a?1d6e","webpack:///./~/parse-uri/index.js","webpack:///./src/background.js","webpack:///./src/util/requests.js?8d47","webpack:///./src/util/url.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","18","str","opts","key","q","parser","strict","loose","strictMode","exec","uri","replace","$0","$1","$2","19","handleMessage","request","sender","sendResponse","action","handleBeginAuth","payload","updateFocusedWindow","url","selectedEntry","selectEntry","clearEntry","localStorage","setItem","domain","metadata","authEndpoint","tokenEndpoint","micropub","chrome","tabs","create","authUrl","tab","authTabId","id","_url","cleanUrl","removeItem","handleTabChange","tabId","changeInfo","isAuthRedirect","code","getParamFromUrl","fetchToken","then","data","token","getParamFromUrlString","remove","status","startsWith","params","redirect_uri","client_id","me","getItem","_requests","post","menuId","runtime","onMessage","addListener","onUpdated","contextMenus","title","contexts","onclick","window","open","2","body","console","warn","getParamString","fetch","method","headers","Accept","Content-Type","JSON","stringify","res","text","prop","Array","isArray","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","val","push","err","return","join","postFormData","Promise","resolve","reject","Authorization","formDataFromObject","log","obj","FormData","fieldName","forEach","k","append","7","_interopRequireDefault","default","paramName","split","matches","filter","param","length","substr","decodeURIComponent","cleanParams","clean","paramsToQueryString","parts","_parseUri2","base","protocol","host","port","path","queryKey","_parseUri"],"mappings":"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","file":"background.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 19);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 18:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function parseURI (str, opts) {\n  opts = opts || {}\n\n  var o = {\n    key: ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'],\n    q: {\n      name: 'queryKey',\n      parser: /(?:^|&)([^&=]*)=?([^&]*)/g\n    },\n    parser: {\n      strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n    }\n  }\n\n  var m = o.parser[opts.strictMode ? 'strict' : 'loose'].exec(str)\n  var uri = {}\n  var i = 14\n\n  while (i--) uri[o.key[i]] = m[i] || ''\n\n  uri[o.q.name] = {}\n  uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {\n    if ($1) uri[o.q.name][$1] = $2\n  })\n\n  return uri\n}\n\n\n/***/ }),\n\n/***/ 19:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _requests = __webpack_require__(2);\n\nvar _url = __webpack_require__(7);\n\nvar authTabId = null;\nvar menuId = void 0;\n\nfunction handleMessage(request, sender, sendResponse) {\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n    case 'focus-window':\n      updateFocusedWindow(sender.url, request.payload.selectedEntry);\n      break;\n    case 'select-entry':\n      selectEntry(request.payload.url);\n      break;\n    case 'clear-entry':\n      clearEntry();\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  localStorage.setItem('domain', payload.domain);\n  localStorage.setItem('authEndpoint', payload.metadata.authEndpoint);\n  localStorage.setItem('tokenEndpoint', payload.metadata.tokenEndpoint);\n  localStorage.setItem('micropubEndpoint', payload.metadata.micropub);\n  chrome.tabs.create({ url: payload.authUrl }, function (tab) {\n    authTabId = tab.id;\n  });\n}\n\nfunction updateFocusedWindow(url, selectedEntry) {\n  localStorage.setItem('pageUrl', (0, _url.cleanUrl)(url));\n  if (selectedEntry) {\n    selectEntry(selectedEntry);\n  } else {\n    clearEntry();\n  }\n}\n\nfunction selectEntry(url) {\n  localStorage.setItem('selectedEntry', url);\n}\n\nfunction clearEntry() {\n  localStorage.removeItem('selectedEntry');\n}\n\nfunction handleTabChange(tabId, changeInfo, tab) {\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  var code = (0, _url.getParamFromUrl)('code', changeInfo.url);\n  fetchToken(code).then(function (data) {\n    var token = (0, _url.getParamFromUrlString)('access_token', data);\n    localStorage.setItem('token', token);\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  });\n}\n\nfunction isAuthRedirect(changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: localStorage.getItem('domain')\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return (0, _requests.post)(tokenEndpoint, params);\n}\n\nchrome.runtime.onMessage.addListener(handleMessage);\nchrome.tabs.onUpdated.addListener(handleTabChange);\nmenuId = chrome.contextMenus.create({\n  title: 'Reply to entry',\n  contexts: ['page', 'selection'],\n  onclick: function onclick() {\n    window.open(\"index.html?reply=true\", \"extension_popup\", \"width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000\");\n  }\n});\n\n// chrome.contextMenus.create({\n//   title: 'Reply to link url',\n//   contexts: ['link'],\n//   onclick: function (context) {\n//     chrome.runtime.sendMessage({ action: 'remove-entry-highlight' });\n//     selectEntry(context.linkUrl);\n//     window.open(\"index.html\", \"extension_popup\", \"width=450,height=500,status=no,scrollbars=yes,resizable=no\");\n//   },\n// });\n\n/***/ }),\n\n/***/ 2:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.post = post;\nexports.getParamString = getParamString;\nexports.postFormData = postFormData;\nexports.formDataFromObject = formDataFromObject;\n\n// deprecated\nfunction post(url, payload, body) {\n  console.warn('Using deprecated function: requests.post');\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(url + '?' + params, {\n    method: 'POST',\n    headers: {\n      'Accept': 'application/json, text/plain, */*',\n      'Content-Type': 'application/json'\n    },\n    body: body ? JSON.stringify(body) : null\n  }).then(function (res) {\n    return res.text();\n  });\n}\n\nfunction getParamString(payload) {\n  var params = [];\n  for (var prop in payload) {\n    var value = payload[prop];\n    if (Array.isArray(value)) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = value[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var val = _step.value;\n\n          params.push(prop + '[]=' + val);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    } else {\n      params.push(prop + '=' + value);\n    }\n  }\n  return params.join('&');\n}\n\n// x-www-form-urlencoded example: https://hacks.mozilla.org/2015/03/this-api-is-so-fetching/\n\nfunction postFormData(url, payload, token) {\n  return new Promise(function (resolve, reject) {\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Authorization': 'Bearer ' + token\n      },\n      body: formDataFromObject(payload)\n    }).then(function (res) {\n      if (res.status < 200 || res.status >= 400) {\n        return reject(res.status);\n      }\n      console.log(res.headers.get('Location'));\n      // TODO: get location/url of post & display somehow\n      resolve(res.text());\n    });\n  });\n}\n\nfunction formDataFromObject(obj) {\n  var data = new FormData();\n  for (var fieldName in obj) {\n    if (Array.isArray(obj[fieldName])) {\n      obj[fieldName].forEach(function (val, k) {\n        data.append(fieldName, val);\n      });\n    } else {\n      data.append(fieldName, obj[fieldName]);\n    }\n  }\n  return data;\n}\n\n/***/ }),\n\n/***/ 7:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getParamFromUrl = getParamFromUrl;\nexports.getParamFromUrlString = getParamFromUrlString;\nexports.cleanParams = cleanParams;\nexports.paramsToQueryString = paramsToQueryString;\nexports.cleanUrl = cleanUrl;\n\nvar _parseUri = __webpack_require__(18);\n\nvar _parseUri2 = _interopRequireDefault(_parseUri);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\nfunction getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(function (param) {\n    return param.startsWith(paramName + '=');\n  });\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nfunction cleanParams(params) {\n  var clean = {};\n  for (var i in params) {\n    if (!i.startsWith('utm_')) {\n      clean[i] = params[i];\n    }\n  }\n  return clean;\n}\n\nfunction paramsToQueryString(params) {\n  var parts = [];\n  for (var i in params) {\n    parts.push(i + '=' + params[i]);\n  }\n  if (!parts.length) {\n    return '';\n  }\n  return '?' + parts.join('&');\n}\n\n// strip hashes and utm_* query params\nfunction cleanUrl(url) {\n  var parts = (0, _parseUri2.default)(url);\n  var base = [parts.protocol, '://', parts.host, parts.port ? ':' + parts.port : '', parts.path, paramsToQueryString(cleanParams(parts.queryKey))].join('');\n  return base;\n}\n\n/***/ })\n\n/******/ });\n\n\n// WEBPACK FOOTER //\n// background.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6d1ed100ed120854df2a","'use strict'\n\nmodule.exports = function parseURI (str, opts) {\n  opts = opts || {}\n\n  var o = {\n    key: ['source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'],\n    q: {\n      name: 'queryKey',\n      parser: /(?:^|&)([^&=]*)=?([^&]*)/g\n    },\n    parser: {\n      strict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      loose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/\n    }\n  }\n\n  var m = o.parser[opts.strictMode ? 'strict' : 'loose'].exec(str)\n  var uri = {}\n  var i = 14\n\n  while (i--) uri[o.key[i]] = m[i] || ''\n\n  uri[o.q.name] = {}\n  uri[o.key[12]].replace(o.q.parser, function ($0, $1, $2) {\n    if ($1) uri[o.q.name][$1] = $2\n  })\n\n  return uri\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/parse-uri/index.js\n// module id = 18\n// module chunks = 2","import {post} from './util/requests';\nimport {getParamFromUrl, getParamFromUrlString, cleanUrl} from './util/url';\n\nlet authTabId = null;\nlet menuId;\n\nfunction handleMessage(request, sender, sendResponse) {\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n    case 'focus-window':\n      updateFocusedWindow(sender.url, request.payload.selectedEntry);\n      break;\n    case 'select-entry':\n      selectEntry(request.payload.url);\n      break;\n    case 'clear-entry':\n      clearEntry();\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  localStorage.setItem('domain', payload.domain);\n  localStorage.setItem('authEndpoint', payload.metadata.authEndpoint);\n  localStorage.setItem('tokenEndpoint', payload.metadata.tokenEndpoint);\n  localStorage.setItem('micropubEndpoint', payload.metadata.micropub);\n  chrome.tabs.create({url: payload.authUrl}, (tab) => {\n    authTabId = tab.id;\n  });\n}\n\nfunction updateFocusedWindow(url, selectedEntry) {\n  localStorage.setItem('pageUrl', cleanUrl(url));\n  if (selectedEntry) {\n    selectEntry(selectedEntry);\n  } else {\n    clearEntry();\n  }\n}\n\nfunction selectEntry(url) {\n  localStorage.setItem('selectedEntry', url);\n}\n\nfunction clearEntry() {\n  localStorage.removeItem('selectedEntry');\n}\n\nfunction handleTabChange (tabId, changeInfo, tab) {\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  var code = getParamFromUrl('code', changeInfo.url);\n  fetchToken(code)\n  .then(function (data) {\n    var token = getParamFromUrlString('access_token', data);\n    localStorage.setItem('token', token)\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  });\n}\n\nfunction isAuthRedirect (changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: localStorage.getItem('domain'),\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return post(tokenEndpoint, params);\n}\n\nchrome.runtime.onMessage.addListener(handleMessage);\nchrome.tabs.onUpdated.addListener(handleTabChange);\nmenuId = chrome.contextMenus.create({\n  title: 'Reply to entry',\n  contexts: ['page', 'selection'],\n  onclick: function () {\n    window.open(\"index.html?reply=true\", \"extension_popup\", \"width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000\");\n  },\n});\n\n// chrome.contextMenus.create({\n//   title: 'Reply to link url',\n//   contexts: ['link'],\n//   onclick: function (context) {\n//     chrome.runtime.sendMessage({ action: 'remove-entry-highlight' });\n//     selectEntry(context.linkUrl);\n//     window.open(\"index.html\", \"extension_popup\", \"width=450,height=500,status=no,scrollbars=yes,resizable=no\");\n//   },\n// });\n\n\n\n// WEBPACK FOOTER //\n// ./src/background.js","\n// deprecated\nexport function post (url, payload, body) {\n  console.warn('Using deprecated function: requests.post');\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(`${url}?${params}`, {\n    method: 'POST',\n    headers: {\n       'Accept': 'application/json, text/plain, */*',\n       'Content-Type': 'application/json'\n   },\n    body: body ? JSON.stringify(body) : null\n  })\n  .then(function (res) {\n    return res.text();\n  });\n}\n\nexport function getParamString (payload) {\n  var params = [];\n  for (var prop in payload) {\n    const value = payload[prop];\n    if (Array.isArray(value)) {\n      for (let val of value) {\n        params.push(`${prop}[]=${val}`);\n      }\n    } else {\n      params.push(`${prop}=${value}`);\n    }\n  }\n  return params.join('&');\n}\n\n// x-www-form-urlencoded example: https://hacks.mozilla.org/2015/03/this-api-is-so-fetching/\n\nexport function postFormData(url, payload, token) {\n  return new Promise(function (resolve, reject) {\n    fetch(url, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n      },\n      body: formDataFromObject(payload),\n    })\n    .then(function (res) {\n      if (res.status < 200 || res.status >= 400) {\n        return reject(res.status);\n      }\n      console.log(res.headers.get('Location'));\n      // TODO: get location/url of post & display somehow\n      resolve(res.text());\n    });\n  });\n}\n\nexport function formDataFromObject(obj) {\n  var data = new FormData();\n  for (var fieldName in obj) {\n    if (Array.isArray(obj[fieldName])) {\n      obj[fieldName].forEach((val, k) => {\n        data.append(fieldName, val);\n      });\n    } else {\n      data.append(fieldName, obj[fieldName]);\n    }\n  }\n  return data;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util/requests.js","import parseUri from 'parse-uri';\n\nexport function getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\nexport function getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(param => param.startsWith(`${paramName}=`));\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nexport function cleanParams(params) {\n  const clean = {};\n  for (let i in params) {\n    if (!i.startsWith('utm_')) {\n      clean[i] = params[i];\n    }\n  }\n  return clean;\n}\n\nexport function paramsToQueryString(params) {\n  const parts = [];\n  for (let i in params) {\n    parts.push(`${i}=${params[i]}`);\n  }\n  if (!parts.length) {\n    return '';\n  }\n  return `?${parts.join('&')}`;\n}\n\n// strip hashes and utm_* query params\nexport function cleanUrl(url) {\n  const parts = parseUri(url);\n  const base = [\n    parts.protocol,\n    '://',\n    parts.host,\n    parts.port ? `:${parts.port}` : '',\n    parts.path,\n    paramsToQueryString(cleanParams(parts.queryKey))\n  ].join('');\n  return base;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util/url.js"],"sourceRoot":""}