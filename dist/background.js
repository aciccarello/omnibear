(function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=13)})({13:function(t,e,n){"use strict";function o(t,e,n){switch(t.action){case"begin-auth":r(t.payload);break;case"select-entry":a(t.payload.url);break;case"clear-entry":i()}}function r(t){localStorage.setItem("domain",t.domain),localStorage.setItem("authEndpoint",t.metadata.authEndpoint),localStorage.setItem("tokenEndpoint",t.metadata.tokenEndpoint),localStorage.setItem("micropubEndpoint",t.metadata.micropub),chrome.tabs.create({url:t.authUrl},function(t){h=t.id})}function a(t){localStorage.setItem("selectedEntry",t)}function i(){localStorage.removeItem("selectedEntry")}function c(t,e,n){if(t===h&&u(e)){var o=s("code",e.url);p(o).then(function(t){var e=l("access_token",t);localStorage.setItem("token",e),chrome.tabs.remove(n.id),h=null})}}function u(t){var e="http://omnibear.com/auth/success";return"loading"===t.status&&t.url&&t.url.startsWith(e)}function s(t,e){var n=e.split("?")[1];return l(t,n)}function l(t,e){var n=e.split("&").filter(function(e){return e.startsWith(t+"=")});if(n&&n.length){var o=n[0].substr(t.length+1);return decodeURIComponent(o)}return null}function p(t){var e={code:t,redirect_uri:"http://omnibear.com/auth/success/",client_id:"http://omnibear.com",me:"http://keithjgrant.com"},n=localStorage.getItem("tokenEndpoint");return(0,d.post)(n,e)}var d=n(2),h=null;chrome.runtime.onMessage.addListener(o),chrome.tabs.onUpdated.addListener(c),chrome.contextMenus.create({title:"Reply to highlighted entry",contexts:["page","selection"],onclick:function(){window.open("index.html","extension_popup","width=450,height=500,status=no,scrollbars=yes,resizable=no")}}),chrome.contextMenus.create({title:"Reply to link url",contexts:["link"],onclick:function(t){chrome.runtime.sendMessage({action:"remove-entry-highlight"}),a(t.linkUrl),window.open("index.html","extension_popup","width=450,height=500,status=no,scrollbars=yes,resizable=no")}})},2:function(t,e,n){"use strict";function o(t,e,n){console.warn("Using deprecated function: requests.post");var o;return o="string"==typeof e?e:r(e),fetch(t+"?"+o,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:n?JSON.stringify(n):null}).then(function(t){return t.text()})}function r(t){var e=[];for(var n in t)e.push(n+"="+t[n]);return e.join("&")}function a(t,e,n){return console.warn("Using deprecated function: requests.postMicropub"),fetch(t,{method:"POST",headers:{Authorization:"Bearer "+n},body:new FormData(e)}).then(function(t){return t.text()})}function i(t,e,n){return new Promise(function(o,r){fetch(t,{method:"POST",headers:{Authorization:"Bearer "+n},body:c(e)}).then(function(t){return t.status<200||t.status>=400?r(t.status):void o(t.text())})})}function c(t){var e=new FormData;for(var n in t)Array.isArray(t[n])?t[n].forEach(function(t,o){e.append(n,t)}):e.append(n,t[n]);return e}Object.defineProperty(e,"__esModule",{value:!0}),e.post=o,e.getParamString=r,e.postMicropub=a,e.postFormData=i,e.formDataFromObject=c}});
//# sourceMappingURL=background.js.map