(function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=24)})([,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NEW_NOTE="new-note",t.PAGE_REPLY="page-reply",t.ITEM_REPLY="item-reply",t.MESSAGE_SUCCESS="success",t.MESSAGE_ERROR="error",t.DEFAULT_REACJI=["👍","👎","🎉","😆","😢","😠"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLogs=s,t.clearLogs=function(){localStorage.setItem("log","[]")},t.info=u,t.warning=function(e,t){c(e,t,i)},t.error=function(e,t){c(e,t,a)};var n=r(5),o="info",i="warning",a="error";function s(){var e=JSON.parse(localStorage.getItem("log"));return e||[]}function c(e,t,r){if(o=(0,n.getSettings)(),console.log(o),o.debugLog||r===a){var o,i=s();i.length>100&&i.unshift();var c,u={message:e,type:r,timestamp:(c=new Date,c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"."+c.getMilliseconds())};t&&(u.data=t),i.push(u),function(e){localStorage.setItem("log",JSON.stringify(e))}(i)}}function u(e,t){c(e,t,o)}t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openLink=function(e){e.preventDefault(),e.target.href&&chrome.tabs.create({url:e.target.href})},t.clone=function(e){return JSON.parse(JSON.stringify(e))},t.getAuthTab=function(){return new Promise(function(e,t){chrome.tabs.query({url:"https://omnibear.com/auth/success*"},function(r){r.length?e(r[0]):t("Auth tab not found")})})},t.logout=function(){["token","domain","authEndpoint","tokenEndpoint","micropubEndpoint"].map(function(e){return localStorage.removeItem(e)})},t.generateSlug=function(e){var t=e.toLocaleLowerCase().trim();t=t.replace(/\s/g,"-");for(var r=0,a=o.length;r<a;r++)t=t.replace(new RegExp(o.charAt(r),"g"),i.charAt(r));return(t=(t=t.replace(n,"")).replace(/\-\-+/g,"-")).split("-").splice(0,6).join("-")},t.getPageUrl=function(){return new Promise(function(e,t){var r=localStorage.getItem("pageTabId");chrome.tabs.get(Number(r),function(t){e(t.url)})})};var n=/[^A-Za-z0-9\-]/g,o="áäâàãåčçćďéěëèêẽĕȇęėíìîïňñóöòôõøðřŕšťúůüùûýÿžþÞĐđßÆa·/_,:;",i="aaaaaacccdeeeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa------"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(13),i=(n=o)&&n.__esModule?n:{default:n};t.default=new i.default({clientId:"https://omnibear.com",redirectUri:"https://omnibear.com/auth/success/",state:"very-secret-omnibear-state",me:localStorage.getItem("domain"),authEndpoint:localStorage.getItem("authEndpoint"),tokenEndpoint:localStorage.getItem("tokenEndpoint"),micropubEndpoint:localStorage.getItem("micropubEndpoint"),token:localStorage.getItem("token")})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(){var e=JSON.parse(localStorage.getItem("settings"));if(e)return e;return s},t.saveSettings=function(e){var t={};a.forEach(function(r){t[r]=e[r]}),localStorage.setItem("settings",JSON.stringify(t))},t.saveAuthenticationDetails=function(e,t,r){e&&(localStorage.setItem("domain",e),i.default.options.me=e);t&&(localStorage.setItem("token",t),i.default.options.token=t);r&&(localStorage.setItem("micropubEndpoint",r),i.default.options.micropubEndpoint=r)},t.getSyndicateOptions=function(){var e=localStorage.getItem("syndicateTo");return e&&"undefined"!==e?JSON.parse(e):(localStorage.setItem("syndicateTo","[]"),[])};var n,o=r(4),i=(n=o)&&n.__esModule?n:{default:n};var a=["defaultToCurrentPage","autoSlug","closeAfterPosting","debugLog","reacji","slug","syndicateTo"],s={defaultToCurrentPage:!1,autoSlug:!1,closeAfterPosting:!0,debugLog:!1,reacji:r(1).DEFAULT_REACJI,slug:"mp-slug",syndicateTo:"mp-syndicate-to"}},function(e,t,r){"use strict";var n=String.prototype.replace,o=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,o,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();t.arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},t.merge=function(e,r,o){if(!r)return e;if("object"!=typeof r){if(Array.isArray(e))e.push(r);else{if("object"!=typeof e)return[e,r];(o.plainObjects||o.allowPrototypes||!n.call(Object.prototype,r))&&(e[r]=!0)}return e}if("object"!=typeof e)return[e].concat(r);var i=e;return Array.isArray(e)&&!Array.isArray(r)&&(i=t.arrayToObject(e,o)),Array.isArray(e)&&Array.isArray(r)?(r.forEach(function(r,i){n.call(e,i)?e[i]&&"object"==typeof e[i]?e[i]=t.merge(e[i],r,o):e.push(r):e[i]=r}),e):Object.keys(r).reduce(function(e,i){var a=r[i];return n.call(e,i)?e[i]=t.merge(e[i],a,o):e[i]=a,e},i)},t.assign=function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",n=0;n<t.length;++n){var i=t.charCodeAt(n);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?r+=t.charAt(n):i<128?r+=o[i]:i<2048?r+=o[192|i>>6]+o[128|63&i]:i<55296||i>=57344?r+=o[224|i>>12]+o[128|i>>6&63]+o[128|63&i]:(n+=1,i=65536+((1023&i)<<10|1023&t.charCodeAt(n)),r+=o[240|i>>18]+o[128|i>>12&63]+o[128|i>>6&63]+o[128|63&i])}return r},t.compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],i=o.obj[o.prop],a=Object.keys(i),s=0;s<a.length;++s){var c=a[s],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:i,prop:c}),r.push(u))}return function(e){for(var t;e.length;){var r=e.pop();if(t=r.obj[r.prop],Array.isArray(t)){for(var n=[],o=0;o<t.length;++o)void 0!==t[o]&&n.push(t[o]);r.obj[r.prop]=n}}return t}(t)},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}},,function(e,t,r){"use strict";var n=r(14);r.n(n);r.o(n,"parse")&&r.d(t,"a",function(){return n.parse}),r.o(n,"stringify")&&r.d(t,"c",function(){return n.stringify});var o=r(12);r.d(t,"b",function(){return o.a});var i=r(11);r.d(t,"d",function(){return i.a});var a=r(10);r.d(t,"e",function(){return a.a})},function(e,t,r){"use strict";t.a=function(e,t){const r=-1==e.indexOf("?")?"?":"&";let n=[];for(var o in t)Array.isArray(t[o])?t[o].forEach(e=>{n.push(o+"[]="+encodeURIComponent(e))}):n.push(o+"="+encodeURIComponent(t[o]));const i=n.join("&");return e+r+i}},function(e,t,r){"use strict";t.a=function e(t,r=new FormData,n=!1){Object.keys(t).forEach(o=>{const i=t[o];n&&(o=n+"["+o+"]"),Array.isArray(i)?i.forEach(t=>{const n={};n[o+"[]"]=t,r=e(n,r)}):r.append(o,i)});return r}},function(e,t,r){"use strict";t.a=function(e,t){let r={},n=t;const o=(new DOMParser).parseFromString(e,"text/html"),i=o.querySelector("base[href]"),a=o.querySelectorAll("[rel][href]");if(i){const e=i.getAttribute("href"),r=new URL(e,t);n=r.toString()}return a.length&&a.forEach(e=>{const t=e.getAttribute("rel").toLowerCase().split("\\s+"),o=e.getAttribute("href");t.length&&null!==o&&t.forEach(e=>{r[e]||(r[e]=[]);const t=new URL(o,n).toString();-1===r[e].indexOf(t)&&r[e].push(t)})}),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var n=r(9);const o=n.a,i=n.b,a=n.c,s=n.d,c=n.e;n.FormData&&!e.FormData&&(e.FormData=n.FormData),n.DOMParser&&!e.DOMParser&&(e.DOMParser=n.DOMParser),n.URL&&!e.URL&&(e.URL=n.URL);const u={me:"",scope:"post create delete update",token:"",authEndpoint:"",tokenEndpoint:"",micropubEndpoint:""},l=(e,t=null,r=null)=>({message:e,status:t,error:r});t.default=class{constructor(e={}){this.options=Object.assign({},u,e),this.create=this.create.bind(this),this.update=this.update.bind(this),this.delete=this.delete.bind(this),this.undelete=this.undelete.bind(this),this.postMicropub=this.postMicropub.bind(this),this.checkRequiredOptions=this.checkRequiredOptions.bind(this),this.getAuthUrl=this.getAuthUrl.bind(this),this.getEndpointsFromUrl=this.getEndpointsFromUrl.bind(this)}checkRequiredOptions(e){let t=[],r=!0;for(var n=0;n<e.length;n++){const o=e[n];this.options[o]||(r=!1,t.push(o))}return{pass:r,missing:t}}getEndpointsFromUrl(e){return new Promise((t,r)=>{let n={micropub:null,authorization_endpoint:null,token_endpoint:null},o=e;fetch(e).then(t=>{if(!t.ok)return r(l("Error getting page",t.status));o=t.url;const i=t.headers.get("link");return i&&i.split(",").forEach(t=>{Object.keys(n).forEach(r=>{const o=t.match(/rel=("([^"]*)"|([^,"<]+))/);if(o&&o[1]&&(" "+o[1].toLowerCase()+" ").indexOf(" "+r+" ")>=0){const o=t.match(/[^<>|\s]+/g);if(o&&o[0]){let t=o[0];t=new URL(t,e).toString(),n[r]=t}}})}),t.text()}).then(a=>{const s=i(a,o);return this.options.me=e,s&&Object.keys(n).forEach(e=>{s[e]&&s[e][0]&&(n[e]=s[e][0])}),n.micropub&&n.authorization_endpoint&&n.token_endpoint?(this.options.micropubEndpoint=n.micropub,this.options.tokenEndpoint=n.token_endpoint,this.options.authEndpoint=n.authorization_endpoint,t({auth:this.options.authEndpoint,token:this.options.tokenEndpoint,micropub:this.options.micropubEndpoint})):r(l("Error getting microformats data"))}).catch(e=>r(l("Error fetching url",null,e)))})}getToken(e){return new Promise((t,r)=>{const n=this.checkRequiredOptions(["me","clientId","redirectUri","tokenEndpoint"]);if(!n.pass)return r(l("Missing required options: "+n.missing.join(", ")));const i={grant_type:"authorization_code",me:this.options.me,code:e,client_id:this.options.clientId,redirect_uri:this.options.redirectUri},s={method:"POST",body:a(i),headers:new Headers({"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json, application/x-www-form-urlencoded"})};fetch(this.options.tokenEndpoint,s).then(e=>{if(!e.ok)return r(l("Error getting token",e.status));const t=e.headers.get("Content-Type");return t&&0===t.indexOf("application/json")?e.json():e.text()}).then(e=>("string"==typeof e&&(e=o(e)),e.error_description?r(l(e.error_description)):e.error?r(l(e.error)):e.me&&e.scope&&e.access_token?e.me&&e.me.replace(/\/+$/,"")!==this.options.me.replace(/\/+$/,"")?r(l("The me values did not match")):(this.options.token=e.access_token,void t(e.access_token)):r(l("The token endpoint did not return the expected parameters")))).catch(e=>r(l("Error requesting token endpoint",null,e)))})}getAuthUrl(){return new Promise((e,t)=>{let r=this.checkRequiredOptions(["me","state"]);if(!r.pass)return t(l("Missing required options: "+r.missing.join(", ")));this.getEndpointsFromUrl(this.options.me).then(()=>{let r=this.checkRequiredOptions(["me","state","scope","clientId","redirectUri"]);if(!r.pass)return t(l("Missing required options: "+r.missing.join(", ")));const n={me:this.options.me,client_id:this.options.clientId,redirect_uri:this.options.redirectUri,response_type:"code",scope:this.options.scope,state:this.options.state};e(this.options.authEndpoint+"?"+a(n))}).catch(e=>t(l("Error getting auth url",null,e)))})}verifyToken(){return new Promise((e,t)=>{const r=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!r.pass)return t(l("Missing required options: "+r.missing.join(", ")));const n={method:"GET",headers:new Headers({Authorization:"Bearer "+this.options.token})};fetch(this.options.micropubEndpoint,n).then(r=>r.ok?e(!0):t(l("Error verifying token",r.status))).catch(e=>t(l("Error verifying token",null,e)))})}create(e,t="json"){return this.postMicropub(e,t)}update(e,t){return this.postMicropub(Object.assign({action:"update",url:e},t))}delete(e){return this.postMicropub({action:"delete",url:e})}undelete(e){return this.postMicropub({action:"undelete",url:e})}postMicropub(e,t="json"){return new Promise((r,n)=>{const i=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!i.pass)return n(l("Missing required options: "+i.missing.join(", ")));let c={method:"POST"};"json"==t?(c.body=JSON.stringify(e),c.headers=new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/json",Accept:"application/json, application/x-www-form-urlencoded"})):"form"==t?(c.body=a(e,{arrayFormat:"brackets"}),c.headers=new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json, application/x-www-form-urlencoded"})):"multipart"==t&&(c.body=s(e),c.headers=new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":void 0,Accept:"application/json, application/x-www-form-urlencoded"})),fetch(this.options.micropubEndpoint,c).then(e=>{if(!e.ok)return n(l("Error with micropub request",e.status));const t=e.headers.get("Location")||e.headers.get("location");if(t)return r(t);const o=e.headers.get("Content-Type");return o&&0===o.indexOf("application/json")?e.json():e.text()}).then(e=>("string"==typeof e&&(e=o(e)),e.error_description?n(l(e.error_description)):e.error?n(l(e.error)):r(e))).catch(e=>n(l("Error sending request",null,e)))})}postMedia(e){return new Promise((t,r)=>{const n=this.checkRequiredOptions(["token","mediaEndpoint"]);if(!n.pass)return r(l("Missing required options: "+n.missing.join(", ")));let o={method:"POST",body:s({file:e}),headers:new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":void 0,Accept:"*/*"})};fetch(this.options.mediaEndpoint,o).then(e=>{if(201!==e.status)return r(l("Error creating media",e.status));const n=e.headers.get("Location")||e.headers.get("location");return n?t(n):r(l("Media endpoint did not return a location",e.status))}).catch(e=>r(l("Error sending request")))})}query(e){return new Promise((t,r)=>{const n=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!n.pass)return r(l("Missing required options: "+n.missing.join(", ")));const o=c(this.options.micropubEndpoint,{q:e}),i={method:"GET",headers:new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"})};fetch(o,i).then(t=>t.ok?t.json():r(l("Error getting "+e,t.status))).then(e=>t(e)).catch(t=>r(l("Error getting "+e,null,t)))})}querySource(e,t=[]){return new Promise((r,n)=>{const o=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!o.pass)return n(l("Missing required options: "+o.missing.join(", ")));e=c(this.options.micropubEndpoint,{q:"source",url:e,properties:t});const i={method:"GET",headers:new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"})};fetch(e,i).then(e=>e.ok?e.json():n(l("Error getting source",e.status))).then(e=>r(e)).catch(e=>n(l("Error getting source",null,e)))})}}}.call(t,r(17))},function(e,t,r){"use strict";var n=r(16),o=r(15),i=r(6);e.exports={formats:i,parse:o,stringify:n}},function(e,t,r){"use strict";var n=r(7),o=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:n.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},a=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(n),s=a?n.slice(0,a.index):n,c=[];if(s){if(!r.plainObjects&&o.call(Object.prototype,s)&&!r.allowPrototypes)return;c.push(s)}for(var u=0;null!==(a=i.exec(n))&&u<r.depth;){if(u+=1,!r.plainObjects&&o.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(e,t,r){for(var n=t,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a)i=(i=[]).concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n}n=i}return n}(c,t,r)}};e.exports=function(e,t){var r=t?n.assign({},t):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:i.delimiter,r.depth="number"==typeof r.depth?r.depth:i.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:i.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:i.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:i.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:i.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:i.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:i.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:i.strictNullHandling,""===e||null===e||void 0===e)return r.plainObjects?Object.create(null):{};for(var s="string"==typeof e?function(e,t){for(var r={},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,a=t.parameterLimit===1/0?void 0:t.parameterLimit,s=n.split(t.delimiter,a),c=0;c<s.length;++c){var u,l,p=s[c],d=p.indexOf("]="),f=-1===d?p.indexOf("="):d+1;-1===f?(u=t.decoder(p,i.decoder),l=t.strictNullHandling?null:""):(u=t.decoder(p.slice(0,f),i.decoder),l=t.decoder(p.slice(f+1),i.decoder)),o.call(r,u)?r[u]=[].concat(r[u]).concat(l):r[u]=l}return r}(e,r):e,c=r.plainObjects?Object.create(null):{},u=Object.keys(s),l=0;l<u.length;++l){var p=u[l],d=a(p,s[p],r);c=n.merge(c,d,r)}return n.compact(c)}},function(e,t,r){"use strict";var n=r(7),o=r(6),i={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Date.prototype.toISOString,s={delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,serializeDate:function(e){return a.call(e)},skipNulls:!1,strictNullHandling:!1},c=function e(t,r,o,i,a,c,u,l,p,d,f,h){var g=t;if("function"==typeof u)g=u(r,g);else if(g instanceof Date)g=d(g);else if(null===g){if(i)return c&&!h?c(r,s.encoder):r;g=""}if("string"==typeof g||"number"==typeof g||"boolean"==typeof g||n.isBuffer(g))return c?[f(h?r:c(r,s.encoder))+"="+f(c(g,s.encoder))]:[f(r)+"="+f(String(g))];var m,y=[];if(void 0===g)return y;if(Array.isArray(u))m=u;else{var b=Object.keys(g);m=l?b.sort(l):b}for(var v=0;v<m.length;++v){var E=m[v];a&&null===g[E]||(y=Array.isArray(g)?y.concat(e(g[E],o(r,E),o,i,a,c,u,l,p,d,f,h)):y.concat(e(g[E],r+(p?"."+E:"["+E+"]"),o,i,a,c,u,l,p,d,f,h)))}return y};e.exports=function(e,t){var r=e,a=t?n.assign({},t):{};if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw new TypeError("Encoder has to be a function.");var u=void 0===a.delimiter?s.delimiter:a.delimiter,l="boolean"==typeof a.strictNullHandling?a.strictNullHandling:s.strictNullHandling,p="boolean"==typeof a.skipNulls?a.skipNulls:s.skipNulls,d="boolean"==typeof a.encode?a.encode:s.encode,f="function"==typeof a.encoder?a.encoder:s.encoder,h="function"==typeof a.sort?a.sort:null,g=void 0!==a.allowDots&&a.allowDots,m="function"==typeof a.serializeDate?a.serializeDate:s.serializeDate,y="boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:s.encodeValuesOnly;if(void 0===a.format)a.format=o.default;else if(!Object.prototype.hasOwnProperty.call(o.formatters,a.format))throw new TypeError("Unknown format option provided.");var b,v,E=o.formatters[a.format];"function"==typeof a.filter?r=(v=a.filter)("",r):Array.isArray(a.filter)&&(b=v=a.filter);var w,k=[];if("object"!=typeof r||null===r)return"";w=a.arrayFormat in i?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":"indices";var O=i[w];b||(b=Object.keys(r)),h&&b.sort(h);for(var j=0;j<b.length;++j){var S=b[j];p&&null===r[S]||(k=k.concat(c(r[S],S,O,l,p,d?f:null,v,h,g,m,E,y)))}var A=k.join(u),_=!0===a.addQueryPrefix?"?":"";return A.length>0?_+A:""}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getParamFromUrl=function(e,t){var r=t.split("?")[1];return a(e,r)},t.getParamFromUrlString=a,t.cleanParams=s,t.paramsToQueryString=c,t.getUrlOrigin=function(e){var t=(0,i.default)(e);return[t.protocol,"://",t.host,t.port?":"+t.port:""].join("")},t.cleanUrl=function(e){var t=(0,i.default)(e);return[t.protocol,"://",t.host,t.port?":"+t.port:"",t.path,c(s(t.queryKey))].join("")};var n,o=r(44),i=(n=o)&&n.__esModule?n:{default:n};function a(e,t){var r=t.split("&").filter(function(t){return t.startsWith(e+"=")});if(r&&r.length){var n=r[0].substr(e.length+1);return decodeURIComponent(n)}return null}function s(e){var t={};for(var r in e)r.startsWith("utm_")||(t[r]=e[r]);return t}function c(e){var t=[];for(var r in e)t.push(r+"="+e[r]);return t.length?"?"+t.join("&"):""}},,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchToken=function(e){return i.default.options.me=localStorage.getItem("domain"),i.default.options.tokenEndpoint=localStorage.getItem("tokenEndpoint"),i.default.options.micropubEndpoint=localStorage.getItem("micropubEndpoint"),i.default.getToken(e).then(function(e){if(!e)throw new Error("Token not found in token endpoint response. Missing expected field `access_token`");localStorage.setItem("token",e),i.default.options.token=e}).catch(function(e){(0,s.error)("Error fetching token",e),(0,a.getAuthTab)().then(function(t){chrome.tabs.sendMessage(t.id,{action:"fetch-token-error",payload:{error:e}}),(0,a.logout)()})})},t.fetchSyndicationTargets=function(){return i.default.query("syndicate-to").then(function(e){var t=e["syndicate-to"];(0,s.info)("Syndication targets retreived",t),Array.isArray(t)?localStorage.setItem("syndicateTo",JSON.stringify(t)):((0,s.warning)("Syndication targets not in array format. Saving as empty array."),localStorage.setItem("syndicateTo",JSON.stringify([])))})};var n,o=r(4),i=(n=o)&&n.__esModule?n:{default:n},a=(r(18),r(3)),s=r(2)},,,function(e,t,r){"use strict";var n=r(18),o=r(21),i=(r(3),r(2)),a=null;function s(e){localStorage.setItem("selectedEntry",e)}function c(){localStorage.removeItem("selectedEntry")}chrome.runtime.onMessage.addListener(function(e,t,r){switch(e.action){case"begin-auth":l=e.payload,localStorage.setItem("domain",l.domain),localStorage.setItem("authEndpoint",l.metadata.authEndpoint),localStorage.setItem("tokenEndpoint",l.metadata.tokenEndpoint),localStorage.setItem("micropubEndpoint",l.metadata.micropub),chrome.tabs.create({url:l.authUrl},function(e){a=e.id});break;case"focus-window":o=t.tab.id,i=t.url,u=e.payload.selectedEntry,localStorage.setItem("pageUrl",(0,n.cleanUrl)(i)),localStorage.setItem("pageTabId",o),u?s(u):c();break;case"select-entry":s(e.payload.url);break;case"clear-entry":c()}var o,i,u,l}),chrome.tabs.onUpdated.addListener(function(e,t,r){if(e===a&&function(e){return e.url&&e.url.startsWith("https://omnibear.com/auth/success")}(t)){var s=(0,n.getParamFromUrl)("code",t.url);(0,i.info)("Auth code found beginning '"+s.substr(0,6)+"'. Fetching token…"),(0,o.fetchToken)(s).then(function(){return(0,i.info)("Token retrieved. Fetching syndication targets…"),(0,o.fetchSyndicationTargets)()}).then(function(){(0,i.info)("Authentication complete. Closing authentication tab."),chrome.tabs.remove(r.id),a=null}).catch(function(e){(0,i.error)(e.message,e)})}}),chrome.contextMenus.create({title:"Reply to entry",contexts:["page","selection"],onclick:function(){"undefined"==typeof browser?window.open("index.html?reply=true","extension_popup","width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000"):browser.windows.create({url:"index.html?reply=true",width:450,height:580,type:"panel",left:2e3})}})},,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";e.exports=function(e,t){t=t||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[t.strictMode?"strict":"loose"].exec(e),o={},i=14;i--;)o[r.key[i]]=n[i]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,function(e,t,n){t&&(o[r.q.name][t]=n)}),o}}]);