(function(t){function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var e={};return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=6)})({2:function(t,n,e){"use strict";function o(t,n,e){var o;return o="string"==typeof n?n:a(n),fetch(t+"?"+o,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:e?JSON.stringify(e):null}).then(function(t){return t.text()})}function r(t,n,e){return fetch(t,{method:"POST",headers:{Authorization:"Bearer "+e},body:new FormData(n)}).then(function(t){return t.text()})}function a(t){var n=[];for(var e in t)n.push(e+"="+t[e]);return n.join("&")}t.exports={post:o,postMicropub:r,getParamString:a}},6:function(t,n,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,n,e){switch(console.log("handling message",t),t.action){case"begin-auth":a(t.payload)}}function a(t){console.log(t),localStorage.setItem("domain",t.domain),localStorage.setItem("authEndpoint",t.metadata.authEndpoint),localStorage.setItem("tokenEndpoint",t.metadata.tokenEndpoint),localStorage.setItem("micropubEndpoint",t.metadata.micropub),chrome.tabs.create({url:t.authUrl},function(n){console.log("tab created"),p=t.tabId})}function c(t,n,e){if(console.log(t,p),t===p&&i(n)){console.log("match");var o=u("code",n.url);l(o).then(function(t){var n=s("access_token",t);localStorage.setItem("token",n),chrome.tabs.remove(e.id),p=null})}}function i(t){var n="http://omnibear.com/auth/success";return console.log("changeInfo",t),"loading"===t.status&&t.url&&t.url.startsWith(n)}function u(t,n){var e=n.split("?")[1];return s(t,e)}function s(t,n){var e=n.split("&").filter(function(n){return n.startsWith(t+"=")});if(e&&e.length){var o=e[0].substr(t.length+1);return decodeURIComponent(o)}return null}function l(t){var n={code:t,redirect_uri:"http://omnibear.com/auth/success/",client_id:"http://omnibear.com",me:"http://keithjgrant.com"},e=localStorage.getItem("tokenEndpoint");return f.default.post(e,n)}var d=e(2),f=o(d),p=null;(function(){chrome.runtime.onMessage.addListener(r),chrome.tabs.onUpdated.addListener(c)})()}});
//# sourceMappingURL=background.js.map