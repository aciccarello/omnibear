{"version":3,"sources":["webpack:///main.js","webpack:///webpack/bootstrap 8f14bab04c101cbd9871","webpack:///./src/formUtil.js","webpack:///./src/requests.js","webpack:///./src/background.js","webpack:///./src/router.js","webpack:///./src/routes/login.js","webpack:///./src/routes/popup.js","webpack:///./src/routes/reply.js","webpack:///./src/parseSite.js","webpack:///./src/main.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","getFormValues","form","inputs","querySelectorAll","values","Array","forEach","isArray","push","buildFieldsString","map","encodeURIComponent","join","post","url","payload","body","params","getParamString","fetch","method","headers","Accept","Content-Type","JSON","stringify","then","res","text","postMicropub","token","Authorization","FormData","prop","handleMessage","request","sender","sendResponse","action","handleBeginAuth","localStorage","setItem","domain","authTabId","tabId","handleTabChange","changeInfo","tab","isAuthRedirect","code","getParamFromUrl","fetchToken","data","getParamFromUrlString","chrome","tabs","remove","id","status","startsWith","paramName","split","matches","filter","param","length","substr","decodeURIComponent","redirect_uri","client_id","me","tokenEndpoint","getItem","requests","runtime","onMessage","addListener","onUpdated","router","routes","path","trimPath","default","endsWith","fetchSiteMetadata","document","querySelector","addEventListener","e","preventDefault","fields","getElementById","authEndpoint","Error","micropub","create","sendMessage","el","ensureLoggedIn","window","location","href","logout","clear","postNote","mpEndpoint","response","innerHTML","setTimeout","focus","_defineProperty","obj","key","writable","getLinkValue","page","rel","link","content","createElement","_module$exports","background","login","popup","reply","pathname"],"mappings":"CAAS,SAAUA,GCInB,QAAAC,GAAAC,GAGA,GAAAC,EAAAD,GACA,MAAAC,GAAAD,GAAAE,OAGA,IAAAC,GAAAF,EAAAD,IACAI,EAAAJ,EACAK,GAAA,EACAH,WAUA,OANAJ,GAAAE,GAAAM,KAAAH,EAAAD,QAAAC,IAAAD,QAAAH,GAGAI,EAAAE,GAAA,EAGAF,EAAAD,QAvBA,GAAAD,KA+DA,OAnCAF,GAAAQ,EAAAT,EAGAC,EAAAS,EAAAP,EAGAF,EAAAK,EAAA,SAAAK,GAA2C,MAAAA,IAG3CV,EAAAW,EAAA,SAAAR,EAAAS,EAAAC,GACAb,EAAAc,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAb,EAAAoB,EAAA,SAAAhB,GACA,GAAAS,GAAAT,KAAAiB,WACA,WAA2B,MAAAjB,GAAA,SAC3B,WAAiC,MAAAA,GAEjC,OADAJ,GAAAW,EAAAE,EAAA,IAAAA,GACAA,GAIAb,EAAAc,EAAA,SAAAQ,EAAAC,GAAsD,MAAAR,QAAAS,UAAAC,eAAAlB,KAAAe,EAAAC,IAGtDvB,EAAA0B,EAAA,GAGA1B,IAAA2B,EAAA,MDMM,SAAUvB,EAAQD,EAASH,GAEjC,YEvEA,SAAS4B,GAAeC,GACtB,GAAIC,GAASD,EAAKE,iBAAiB,yBAC/BC,IAWJ,OAVAC,OAAMT,UAAUU,QAAQ3B,KAAKuB,EAAQ,SAACzB,GACN,mBAAnB2B,GAAO3B,EAAEO,MAClBoB,EAAO3B,EAAEO,MAAQP,EAAEK,OAEduB,MAAME,QAAQH,EAAO3B,EAAEO,SAC1BoB,EAAO3B,EAAEO,OAASoB,EAAO3B,EAAEO,QAE7BoB,EAAO3B,EAAEO,MAAMwB,KAAK/B,EAAEK,UAGnBsB,EAGT,QAASK,GAAmBR,GAC1B,GAAIC,GAASD,EAAKE,iBAAiB,yBAC/BC,EAASC,MAAMT,UAAUc,IAAI/B,KAAKuB,EAAQ,SAACzB,GAC7C,MAAUA,GAAEO,KAAZ,IAAoB2B,mBAAmBlC,EAAEK,QAE3C,OAAOsB,GAAOQ,KAAK,KAGrBpC,EAAOD,SACLyB,cAAeA,EACfS,kBAAmBA,IF+Ef,SAAUjC,EAAQD,EAASH,GAEjC,YG3GA,SAASyC,GAAMC,EAAKC,EAASC,GAC3B,GAAIC,EAMJ,OAJEA,GADqB,gBAAZF,GACAA,EAEAG,EAAeH,GAEnBI,MAASL,EAAT,IAAgBG,GACrBG,OAAQ,OACRC,SACGC,OAAU,oCACVC,eAAgB,oBAEnBP,KAAMA,EAAOQ,KAAKC,UAAUT,GAAQ,OAErCU,KAAK,SAAUC,GACd,MAAOA,GAAIC,SAIf,QAASC,GAAcf,EAAKb,EAAM6B,GAChC,MAAOX,OAAML,GACXM,OAAQ,OACRC,SACEU,cAAA,UAA2BD,GAE7Bd,KAAM,GAAIgB,UAAS/B,KAEpByB,KAAK,SAAUC,GACd,MAAOA,GAAIC,SAIf,QAASV,GAAgBH,GACvB,GAAIE,KACJ,KAAK,GAAIgB,KAAQlB,GACfE,EAAOT,KAAQyB,EAAf,IAAuBlB,EAAQkB,GAEjC,OAAOhB,GAAOL,KAAK,KAGrBpC,EAAOD,SACLsC,KAAMA,EACNgB,aAAcA,EACdX,eAAgBA,IHiHZ,SAAU1C,EAAQD,EAASH,GAEjC,YI5JA,SAAS8D,GAAcC,EAASC,EAAQC,GACtC,OAAQF,EAAQG,QACd,IAAK,aACHC,EAAgBJ,EAAQpB,UAK9B,QAASwB,GAAgBxB,GACvByB,aAAaC,QAAQ,SAAU1B,EAAQ2B,QACvCC,EAAY5B,EAAQ6B,MAGtB,QAASC,GAAiBD,EAAOE,EAAYC,GAC3C,GAAIH,IAAUD,GAAcK,EAAeF,GAA3C,CAGA,GAAIG,GAAOC,EAAgB,OAAQJ,EAAWhC,IAC9CqC,GAAWF,GACVvB,KAAK,SAAU0B,GACd,GAAItB,GAAQuB,EAAsB,eAAgBD,EAClDZ,cAAaC,QAAQ,QAASX,GAC9BwB,OAAOC,KAAKC,OAAOT,EAAIU,IACvBd,EAAY,QAIhB,QAASK,GAAgBF,GACvB,GAAIhC,GAAM,kCACV,OAA6B,YAAtBgC,EAAWY,QAAwBZ,EAAWhC,KAAOgC,EAAWhC,IAAI6C,WAAW7C,GAIxF,QAASoC,GAAgBU,EAAW9C,GAClC,GAAIG,GAASH,EAAI+C,MAAM,KAAK,EAC5B,OAAOR,GAAsBO,EAAW3C,GAI1C,QAASoC,GAAsBO,EAAW3C,GACxC,GAAI6C,GAAU7C,EAAO4C,MAAM,KAAKE,OAAO,SAAAC,GAAA,MAASA,GAAML,WAAcC,EAApB,MAChD,IAAIE,GAAWA,EAAQG,OAAQ,CAC7B,GAAInF,GAAQgF,EAAQ,GAAGI,OAAON,EAAUK,OAAS,EACjD,OAAOE,oBAAmBrF,GAE1B,MAAO,MAIX,QAASqE,GAAWF,GAClB,GAAIhC,IACFgC,KAAMA,EACNmB,aAAc,oCACdC,UAAW,sBACXC,GAAI,0BAEFC,EAAgB/B,aAAagC,QAAQ,gBACzC,OAAOC,GAAS5D,KAAK0D,EAAetD,GA7DtC,GAAIwD,GAAWrG,EAAQ,GAEnBuE,EAAY,IA8DhBnE,GAAOD,QAAU,WACf+E,OAAOoB,QAAQC,UAAUC,YAAY1C,GACrCoB,OAAOC,KAAKsB,UAAUD,YAAY/B,KJyK9B,SAAUrE,EAAQD,EAASH,GAEjC,YK5OA,SAAS0G,GAAQC,EAAQC,GACvB,GAAIA,GAAOC,EAASD,EACR,+BAARA,IACFA,EAAO,cAELD,EAAOC,GACTD,EAAOC,KACED,EAAOG,SAChBH,EAAOG,UAIX,QAASD,GAAUD,GAOjB,MANIA,GAAKrB,WAAW,OAClBqB,EAAOA,EAAKd,OAAO,IAEjBc,EAAKG,SAAS,WAChBH,EAAOA,EAAKd,OAAO,EAAGc,EAAKf,OAAS,IAE/Be,EAGTxG,EAAOD,SACLuG,OAAQA,EACRG,SAAUA,ILoPN,SAAUzG,EAAQD,EAASH,GAEjC,YM/QA,IAAIgH,GAAoBhH,EAAQ,GAAgBgH,kBAC5C3E,EAAoBrC,EAAQ,GAAeqC,iBAE/CjC,GAAOD,QAAU,WACf,GAAI0B,GAAOoF,SAASC,cAAc,gBAClCrF,GAAKsF,iBAAiB,SAAU,SAAUC,GACxCA,EAAEC,gBACF,IAAIC,GAASjF,EAAkBR,GAC3ByC,EAAS2C,SAASM,eAAe,UAAU7G,KAClCuG,UAASM,eAAe,SACrCP,GAAkB1C,GACjBhB,KAAK,SAAU0B,GACd,IAAKA,EAAKwC,aACR,KAAM,IAAIC,OAAM,oCAElB,KAAKzC,EAAKmB,cACR,KAAM,IAAIsB,OAAM,2BAElB,KAAKzC,EAAK0C,SACR,KAAM,IAAID,OAAM,qBAElBrD,cAAaC,QAAQ,eAAgBW,EAAKwC,cAC1CpD,aAAaC,QAAQ,gBAAiBW,EAAKmB,eAC3C/B,aAAaC,QAAQ,mBAAoBW,EAAK0C,UAC9CxC,OAAOC,KAAKwC,QAASjF,IAAQsC,EAAKwC,aAAb,IAA6BF,GAAY,SAAU3C,GACtEO,OAAOoB,QAAQsB,aACb1D,OAAQ,aACRvB,SACE6B,MAAOG,EAAIU,GACXf,OAAQA,aN2Rd,SAAUlE,EAAQD,EAASH,GAEjC,YOvTA,SAAS6H,GAAGxC,GACV,MAAO4B,UAASM,eAAelC,GAGjC,QAASyC,KACP,GAAIpE,GAAQU,aAAagC,QAAQ,QAC5B1C,KACHqE,OAAOC,SAASC,KAAO,cAI3B,QAASC,KACP9D,aAAa+D,QACbJ,OAAOC,SAASC,KAAO,aAGzB,QAASG,KACP,GAAIvG,GAAOgG,EAAG,QACVnE,EAAQU,aAAagC,QAAQ,SAC7BiC,EAAajE,aAAagC,QAAQ,mBACtC3C,GAAa4E,EAAYxG,EAAM6B,GAC9BJ,KAAK,SAAUgF,MAxBlB,GAAI7E,GAAezD,EAAQ,GAAeyD,YAC3BzD,GAAQ,EA4BvBI,GAAOD,QAAU,WACf2H,IAEAD,EAAG,oBAAoBU,UAAYnE,aAAagC,QAAQ,UACxDyB,EAAG,UAAUV,iBAAiB,QAAS,SAAUC,GAC/CA,EAAEC,iBACFa,MAEFL,EAAG,QAAQV,iBAAiB,SAAU,SAAUC,GAG9C,MAFAA,GAAEC,iBACFe,KACO,IAETI,WAAW,WACTX,EAAG,iBAAiBY,SACnB,OPqUC,SAAUrI,EAAQD,EAASH,GAEjC,YQnXeA,GAAQ,EAEvBI,GAAOD,QAAU,cR0XX,SAAUC,EAAQD,EAASH,GAEjC,YAKA,SAAS0I,GAAgBC,EAAKC,EAAKlI,GAAiK,MAApJkI,KAAOD,GAAO5H,OAAOC,eAAe2H,EAAKC,GAAOlI,MAAOA,EAAOQ,YAAY,EAAMD,cAAc,EAAM4H,UAAU,IAAkBF,EAAIC,GAAOlI,EAAgBiI,ESlY3M,QAASG,GAAaC,EAAMC,GAC1B,GAAIC,GAAOF,EAAK7B,cAAL,aAAgC8B,EAAhC,KACX,OAAIC,GACKA,EAAKhB,KAEL,KAIX,QAASjB,GAAkBtE,GACzB,MAAOK,OAAML,GACZY,KAAK,SAAUC,GACd,MAAOA,GAAIC,SACVF,KAAK,SAAU4F,GAChB,GAAIH,GAAO9B,SAASkC,cAAc,OAElC,OADAJ,GAAKR,UAAYW,GAEf1B,aAAcsB,EAAaC,EAAM,0BACjC5C,cAAe2C,EAAaC,EAAM,kBAClCrB,SAAUoB,EAAaC,EAAM,eT6WnC,GAAIK,ESxWJhJ,GAAOD,SAAPiJ,GACEN,gBADFJ,EAAAU,EAAA,eACgBN,GADhBJ,EAAAU,EAAA,oBAEqBpC,GAFrBoC,ITwYM,SAAUhJ,EAAQD,EAASH,GAEjC,YUnaA,IAAI0G,GAAS1G,EAAQ,GAAY0G,OAC7B2C,EAAarJ,EAAQ,GACrBsJ,EAAQtJ,EAAQ,GAChBuJ,EAAQvJ,EAAQ,GAChBwJ,EAAQxJ,EAAQ,EAEpBiH,UAASE,iBAAiB,mBAAoB,WAC5CT,GACE2C,WAAYA,EACZC,MAAOA,EACPC,MAAOA,EACPC,MAAOA,GAENzB,OAAOC,SAASyB","file":"main.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 8);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction getFormValues(form) {\n  var inputs = form.querySelectorAll('input[name], textarea');\n  var values = {};\n  Array.prototype.forEach.call(inputs, function (i) {\n    if (typeof values[i.name] === 'undefined') {\n      values[i.name] = i.value;\n    } else {\n      if (!Array.isArray(values[i.name])) {\n        values[i.name] = [values[i.name]];\n      }\n      values[i.name].push(i.value);\n    }\n  });\n  return values;\n}\n\nfunction buildFieldsString(form) {\n  var inputs = form.querySelectorAll('input[name], textarea');\n  var values = Array.prototype.map.call(inputs, function (i) {\n    return i.name + '=' + encodeURIComponent(i.value);\n  });\n  return values.join('&');\n}\n\nmodule.exports = {\n  getFormValues: getFormValues,\n  buildFieldsString: buildFieldsString\n};\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction post(url, payload, body) {\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(url + '?' + params, {\n    method: 'POST',\n    headers: {\n      'Accept': 'application/json, text/plain, */*',\n      'Content-Type': 'application/json'\n    },\n    body: body ? JSON.stringify(body) : null\n  }).then(function (res) {\n    return res.text();\n  });\n}\n\nfunction postMicropub(url, form, token) {\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Authorization': 'Bearer ' + token\n    },\n    body: new FormData(form)\n  }).then(function (res) {\n    return res.text();\n  });\n}\n\nfunction getParamString(payload) {\n  var params = [];\n  for (var prop in payload) {\n    params.push(prop + '=' + payload[prop]);\n  }\n  return params.join('&');\n}\n\nmodule.exports = {\n  post: post,\n  postMicropub: postMicropub,\n  getParamString: getParamString\n};\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar requests = __webpack_require__(1);\n\nvar authTabId = null;\n\nfunction handleMessage(request, sender, sendResponse) {\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  localStorage.setItem('domain', payload.domain);\n  authTabId = payload.tabId;\n}\n\nfunction handleTabChange(tabId, changeInfo, tab) {\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  var code = getParamFromUrl('code', changeInfo.url);\n  fetchToken(code).then(function (data) {\n    var token = getParamFromUrlString('access_token', data);\n    localStorage.setItem('token', token);\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  });\n}\n\nfunction isAuthRedirect(changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\n// TODO move to util\nfunction getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\n// TODO move to util\nfunction getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(function (param) {\n    return param.startsWith(paramName + '=');\n  });\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: 'http://keithjgrant.com'\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return requests.post(tokenEndpoint, params);\n}\n\nmodule.exports = function () {\n  chrome.runtime.onMessage.addListener(handleMessage);\n  chrome.tabs.onUpdated.addListener(handleTabChange);\n};\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nfunction router(routes, path) {\n  var path = trimPath(path);\n  if (path == '_generated_background_page') {\n    path = 'background';\n  }\n  if (routes[path]) {\n    routes[path]();\n  } else if (routes.default) {\n    routes.default();\n  }\n}\n\nfunction trimPath(path) {\n  if (path.startsWith('/')) {\n    path = path.substr(1);\n  }\n  if (path.endsWith('.html')) {\n    path = path.substr(0, path.length - 5);\n  }\n  return path;\n}\n\nmodule.exports = {\n  router: router,\n  trimPath: trimPath\n};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar fetchSiteMetadata = __webpack_require__(7).fetchSiteMetadata;\nvar buildFieldsString = __webpack_require__(0).buildFieldsString;\n\nmodule.exports = function () {\n  var form = document.querySelector('#login > form');\n  form.addEventListener('submit', function (e) {\n    e.preventDefault();\n    var fields = buildFieldsString(form);\n    var domain = document.getElementById('domain').value;\n    var submit = document.getElementById('submit');\n    fetchSiteMetadata(domain).then(function (data) {\n      if (!data.authEndpoint) {\n        throw new Error('authentication_endpoint not found');\n      }\n      if (!data.tokenEndpoint) {\n        throw new Error('token_endpoint not found');\n      }\n      if (!data.micropub) {\n        throw new Error('micropub not found');\n      }\n      localStorage.setItem('authEndpoint', data.authEndpoint);\n      localStorage.setItem('tokenEndpoint', data.tokenEndpoint);\n      localStorage.setItem('micropubEndpoint', data.micropub);\n      chrome.tabs.create({ url: data.authEndpoint + '?' + fields }, function (tab) {\n        chrome.runtime.sendMessage({\n          action: 'begin-auth',\n          payload: {\n            tabId: tab.id,\n            domain: domain\n          }\n        });\n      });\n    });\n  });\n};\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar postMicropub = __webpack_require__(1).postMicropub;\nvar formUtil = __webpack_require__(0);\n\nfunction el(id) {\n  return document.getElementById(id);\n}\n\nfunction ensureLoggedIn() {\n  var token = localStorage.getItem('token');\n  if (!token) {\n    window.location.href = 'login.html';\n  }\n}\n\nfunction logout() {\n  localStorage.clear();\n  window.location.href = 'login.html';\n}\n\nfunction postNote() {\n  var form = el('post');\n  var token = localStorage.getItem('token');\n  var mpEndpoint = localStorage.getItem('micropubEndpoint');\n  postMicropub(mpEndpoint, form, token).then(function (response) {\n    // TODO\n  });\n}\n\nmodule.exports = function () {\n  ensureLoggedIn();\n\n  el('authenticated-to').innerHTML = localStorage.getItem('domain');\n  el('logout').addEventListener('click', function (e) {\n    e.preventDefault();\n    logout();\n  });\n  el('post').addEventListener('submit', function (e) {\n    e.preventDefault();\n    postNote();\n    return false;\n  });\n  setTimeout(function () {\n    el('input-content').focus();\n  }, 100);\n\n  // chrome.tabs.query({active: true, currentWindow: true}, function (tabs) {\n  //   var currentPageUrl = tabs[0].url;\n  // });\n};\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar formUtil = __webpack_require__(0);\n\nmodule.exports = function () {};\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _module$exports;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction getLinkValue(page, rel) {\n  var link = page.querySelector('link[rel=\"' + rel + '\"]');\n  if (link) {\n    return link.href;\n  } else {\n    return null;\n  }\n}\n\nfunction fetchSiteMetadata(url) {\n  return fetch(url).then(function (res) {\n    return res.text();\n  }).then(function (content) {\n    var page = document.createElement('html');\n    page.innerHTML = content;\n    return {\n      authEndpoint: getLinkValue(page, 'authorization_endpoint'),\n      tokenEndpoint: getLinkValue(page, 'token_endpoint'),\n      micropub: getLinkValue(page, 'micropub')\n    };\n  });\n}\n\nmodule.exports = (_module$exports = {\n  getLinkValue: getLinkValue }, _defineProperty(_module$exports, 'getLinkValue', getLinkValue), _defineProperty(_module$exports, 'fetchSiteMetadata', fetchSiteMetadata), _module$exports);\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar router = __webpack_require__(3).router;\nvar background = __webpack_require__(2);\nvar login = __webpack_require__(4);\nvar popup = __webpack_require__(5);\nvar reply = __webpack_require__(6);\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  router({\n    background: background,\n    login: login,\n    popup: popup,\n    reply: reply\n    // itemReply: itemReply\n  }, window.location.pathname);\n});\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// main.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 8f14bab04c101cbd9871","\nfunction getFormValues (form) {\n  var inputs = form.querySelectorAll('input[name], textarea');\n  var values = {};\n  Array.prototype.forEach.call(inputs, (i) => {\n    if (typeof values[i.name] === 'undefined') {\n      values[i.name] = i.value;\n    } else {\n      if (!Array.isArray(values[i.name])) {\n        values[i.name] = [values[i.name]];\n      }\n      values[i.name].push(i.value);\n    }\n  });\n  return values;\n}\n\nfunction buildFieldsString (form) {\n  var inputs = form.querySelectorAll('input[name], textarea');\n  var values = Array.prototype.map.call(inputs, (i) => {\n    return `${i.name}=${encodeURIComponent(i.value)}`;\n  });\n  return values.join('&');\n}\n\nmodule.exports = {\n  getFormValues: getFormValues,\n  buildFieldsString: buildFieldsString\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/formUtil.js","\nfunction post (url, payload, body) {\n  var params;\n  if (typeof payload === 'string') {\n    params = payload;\n  } else {\n    params = getParamString(payload);\n  }\n  return fetch(`${url}?${params}`, {\n    method: 'POST',\n    headers: {\n       'Accept': 'application/json, text/plain, */*',\n       'Content-Type': 'application/json'\n   },\n    body: body ? JSON.stringify(body) : null\n  })\n  .then(function (res) {\n    return res.text();\n  });\n}\n\nfunction postMicropub (url, form, token) {\n  return fetch(url, {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${token}`,\n    },\n    body: new FormData(form)\n  })\n  .then(function (res) {\n    return res.text();\n  });\n}\n\nfunction getParamString (payload) {\n  var params = [];\n  for (var prop in payload) {\n    params.push(`${prop}=${payload[prop]}`);\n  }\n  return params.join('&');\n}\n\nmodule.exports = {\n  post: post,\n  postMicropub: postMicropub,\n  getParamString: getParamString\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/requests.js","var requests = require('./requests');\n\nvar authTabId = null;\n\nfunction handleMessage(request, sender, sendResponse) {\n  switch (request.action) {\n    case 'begin-auth':\n      handleBeginAuth(request.payload);\n      break;\n  }\n}\n\nfunction handleBeginAuth(payload) {\n  localStorage.setItem('domain', payload.domain);\n  authTabId = payload.tabId;\n}\n\nfunction handleTabChange (tabId, changeInfo, tab) {\n  if (tabId !== authTabId || !isAuthRedirect(changeInfo)) {\n    return;\n  }\n  var code = getParamFromUrl('code', changeInfo.url);\n  fetchToken(code)\n  .then(function (data) {\n    var token = getParamFromUrlString('access_token', data);\n    localStorage.setItem('token', token)\n    chrome.tabs.remove(tab.id);\n    authTabId = null;\n  });\n}\n\nfunction isAuthRedirect (changeInfo) {\n  var url = 'http://omnibear.com/auth/success';\n  return changeInfo.status === 'loading' && changeInfo.url && changeInfo.url.startsWith(url);\n}\n\n// TODO move to util\nfunction getParamFromUrl(paramName, url) {\n  var params = url.split('?')[1];\n  return getParamFromUrlString(paramName, params);\n}\n\n// TODO move to util\nfunction getParamFromUrlString(paramName, params) {\n  var matches = params.split('&').filter(param => param.startsWith(`${paramName}=`));\n  if (matches && matches.length) {\n    var value = matches[0].substr(paramName.length + 1);\n    return decodeURIComponent(value);\n  } else {\n    return null;\n  }\n}\n\nfunction fetchToken(code) {\n  var params = {\n    code: code,\n    redirect_uri: 'http://omnibear.com/auth/success/',\n    client_id: 'http://omnibear.com',\n    me: 'http://keithjgrant.com'\n  };\n  var tokenEndpoint = localStorage.getItem('tokenEndpoint');\n  return requests.post(tokenEndpoint, params);\n}\n\nmodule.exports = function () {\n  chrome.runtime.onMessage.addListener(handleMessage);\n  chrome.tabs.onUpdated.addListener(handleTabChange);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/background.js","\nfunction router (routes, path) {\n  var path = trimPath(path);\n  if (path == '_generated_background_page') {\n    path = 'background';\n  }\n  if (routes[path]) {\n    routes[path]();\n  } else if (routes.default) {\n    routes.default();\n  }\n}\n\nfunction trimPath (path) {\n  if (path.startsWith('/')) {\n    path = path.substr(1);\n  }\n  if (path.endsWith('.html')) {\n    path = path.substr(0, path.length - 5);\n  }\n  return path;\n}\n\nmodule.exports = {\n  router: router,\n  trimPath: trimPath\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/router.js","var fetchSiteMetadata = require('../parseSite').fetchSiteMetadata;\nvar buildFieldsString = require('../formUtil').buildFieldsString;\n\nmodule.exports = function () {\n  var form = document.querySelector('#login > form');\n  form.addEventListener('submit', function (e) {\n    e.preventDefault();\n    var fields = buildFieldsString(form);\n    var domain = document.getElementById('domain').value;\n    var submit = document.getElementById('submit');\n    fetchSiteMetadata(domain)\n    .then(function (data) {\n      if (!data.authEndpoint) {\n        throw new Error('authentication_endpoint not found');\n      }\n      if (!data.tokenEndpoint) {\n        throw new Error('token_endpoint not found');\n      }\n      if (!data.micropub) {\n        throw new Error('micropub not found');\n      }\n      localStorage.setItem('authEndpoint', data.authEndpoint);\n      localStorage.setItem('tokenEndpoint', data.tokenEndpoint);\n      localStorage.setItem('micropubEndpoint', data.micropub);\n      chrome.tabs.create({ url: `${data.authEndpoint}?${fields}` }, function (tab) {\n        chrome.runtime.sendMessage({\n          action: 'begin-auth',\n          payload: {\n            tabId: tab.id,\n            domain: domain\n          }\n        });\n      });\n    });\n  });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/login.js","var postMicropub = require('../requests').postMicropub;\nvar formUtil = require('../formUtil');\n\nfunction el(id) {\n  return document.getElementById(id);\n}\n\nfunction ensureLoggedIn() {\n  var token = localStorage.getItem('token');\n  if (!token) {\n    window.location.href = 'login.html';\n  }\n}\n\nfunction logout() {\n  localStorage.clear();\n  window.location.href = 'login.html';\n}\n\nfunction postNote () {\n  var form = el('post');\n  var token = localStorage.getItem('token');\n  var mpEndpoint = localStorage.getItem('micropubEndpoint');\n  postMicropub(mpEndpoint, form, token)\n  .then(function (response) {\n    // TODO\n  });\n}\n\nmodule.exports = function () {\n  ensureLoggedIn();\n\n  el('authenticated-to').innerHTML = localStorage.getItem('domain');\n  el('logout').addEventListener('click', function (e) {\n    e.preventDefault();\n    logout();\n  });\n  el('post').addEventListener('submit', function (e) {\n    e.preventDefault();\n    postNote();\n    return false;\n  })\n  setTimeout(function () {\n    el('input-content').focus();\n  }, 100);\n\n  // chrome.tabs.query({active: true, currentWindow: true}, function (tabs) {\n  //   var currentPageUrl = tabs[0].url;\n  // });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/popup.js","var formUtil = require('../formUtil');\n\nmodule.exports = function () {\n\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/routes/reply.js","\nfunction getLinkValue(page, rel) {\n  var link = page.querySelector(`link[rel=\"${rel}\"]`);\n  if (link) {\n    return link.href;\n  } else {\n    return null;\n  }\n}\n\nfunction fetchSiteMetadata(url) {\n  return fetch(url)\n  .then(function (res) {\n    return res.text();\n  }).then(function (content) {\n    var page = document.createElement('html');\n    page.innerHTML = content;\n    return {\n      authEndpoint: getLinkValue(page, 'authorization_endpoint'),\n      tokenEndpoint: getLinkValue(page, 'token_endpoint'),\n      micropub: getLinkValue(page, 'micropub')\n    };\n  });\n}\n\nmodule.exports = {\n  getLinkValue, getLinkValue,\n  fetchSiteMetadata: fetchSiteMetadata\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/parseSite.js","var router = require('./router').router;\nvar background = require('./background');\nvar login = require('./routes/login');\nvar popup = require('./routes/popup');\nvar reply = require('./routes/reply');\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  router({\n    background: background,\n    login: login,\n    popup: popup,\n    reply: reply\n    // itemReply: itemReply\n  }, window.location.pathname);\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}