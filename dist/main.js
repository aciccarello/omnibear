(function(t){function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var e={};return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=8)})([function(t,n,e){"use strict";function o(t){var n=t.querySelectorAll("input[name], textarea"),e={};return Array.prototype.forEach.call(n,function(t){"undefined"==typeof e[t.name]?e[t.name]=t.value:(Array.isArray(e[t.name])||(e[t.name]=[e[t.name]]),e[t.name].push(t.value))}),e}function r(t){var n=t.querySelectorAll("input[name], textarea"),e=Array.prototype.map.call(n,function(t){return t.name+"="+encodeURIComponent(t.value)});return e.join("&")}t.exports={getFormValues:o,buildFieldsString:r}},function(t,n,e){"use strict";function o(t,n,e){var o;return o="string"==typeof n?n:i(n),fetch(t+"?"+o,{method:"POST",headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},body:e?JSON.stringify(e):null}).then(function(t){return t.text()})}function r(t,n,e){return fetch(t,{method:"POST",headers:{Authorization:"Bearer "+e},body:new FormData(n)}).then(function(t){return t.text()})}function i(t){var n=[];for(var e in t)n.push(e+"="+t[e]);return n.join("&")}t.exports={post:o,postMicropub:r,getParamString:i}},function(t,n,e){"use strict";function o(t,n,e){switch(t.action){case"begin-auth":r(t.payload)}}function r(t){localStorage.setItem("domain",t.domain),d=t.tabId}function i(t,n,e){if(t===d&&u(n)){var o=a("code",n.url);l(o).then(function(t){var n=c("access_token",t);localStorage.setItem("token",n),chrome.tabs.remove(e.id),d=null})}}function u(t){var n="http://omnibear.com/auth/success";return"loading"===t.status&&t.url&&t.url.startsWith(n)}function a(t,n){var e=n.split("?")[1];return c(t,e)}function c(t,n){var e=n.split("&").filter(function(n){return n.startsWith(t+"=")});if(e&&e.length){var o=e[0].substr(t.length+1);return decodeURIComponent(o)}return null}function l(t){var n={code:t,redirect_uri:"http://omnibear.com/auth/success/",client_id:"http://omnibear.com",me:"http://keithjgrant.com"},e=localStorage.getItem("tokenEndpoint");return s.post(e,n)}var s=e(1),d=null;t.exports=function(){chrome.runtime.onMessage.addListener(o),chrome.tabs.onUpdated.addListener(i)}},function(t,n,e){"use strict";function o(t,n){var n=r(n);"_generated_background_page"==n&&(n="background"),t[n]?t[n]():t.default&&t.default()}function r(t){return t.startsWith("/")&&(t=t.substr(1)),t.endsWith(".html")&&(t=t.substr(0,t.length-5)),t}t.exports={router:o,trimPath:r}},function(t,n,e){"use strict";var o=e(7).fetchSiteMetadata,r=e(0).buildFieldsString;t.exports=function(){var t=document.querySelector("#login > form");t.addEventListener("submit",function(n){n.preventDefault();var e=r(t),i=document.getElementById("domain").value;document.getElementById("submit");o(i).then(function(t){if(!t.authEndpoint)throw new Error("authentication_endpoint not found");if(!t.tokenEndpoint)throw new Error("token_endpoint not found");if(!t.micropub)throw new Error("micropub not found");localStorage.setItem("authEndpoint",t.authEndpoint),localStorage.setItem("tokenEndpoint",t.tokenEndpoint),localStorage.setItem("micropubEndpoint",t.micropub),chrome.tabs.create({url:t.authEndpoint+"?"+e},function(t){chrome.runtime.sendMessage({action:"begin-auth",payload:{tabId:t.id,domain:i}})})})})}},function(t,n,e){"use strict";function o(t){return document.getElementById(t)}function r(){var t=localStorage.getItem("token");t||(window.location.href="login.html")}function i(){localStorage.clear(),window.location.href="login.html"}function u(){var t=o("post"),n=localStorage.getItem("token"),e=localStorage.getItem("micropubEndpoint");a(e,t,n).then(function(t){})}var a=e(1).postMicropub;e(0);t.exports=function(){r(),o("authenticated-to").innerHTML=localStorage.getItem("domain"),o("logout").addEventListener("click",function(t){t.preventDefault(),i()}),o("post").addEventListener("submit",function(t){return t.preventDefault(),u(),!1}),setTimeout(function(){o("input-content").focus()},100)}},function(t,n,e){"use strict";e(0);t.exports=function(){}},function(t,n,e){"use strict";function o(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function r(t,n){var e=t.querySelector('link[rel="'+n+'"]');return e?e.href:null}function i(t){return fetch(t).then(function(t){return t.text()}).then(function(t){var n=document.createElement("html");return n.innerHTML=t,{authEndpoint:r(n,"authorization_endpoint"),tokenEndpoint:r(n,"token_endpoint"),micropub:r(n,"micropub")}})}var u;t.exports=(u={getLinkValue:r},o(u,"getLinkValue",r),o(u,"fetchSiteMetadata",i),u)},function(t,n,e){"use strict";var o=e(3).router,r=e(2),i=e(4),u=e(5),a=e(6);document.addEventListener("DOMContentLoaded",function(){o({background:r,login:i,popup:u,reply:a},window.location.pathname)})}]);
//# sourceMappingURL=main.js.map